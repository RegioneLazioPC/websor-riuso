(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1001:function(e,t){},1141:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(14),i=a.n(o),s=(a(658),a(35)),l=a.n(s),c=a(58),u=a(20),p=a(21),d=a(25),h=a(24),m=a(26),f=(a(278),a(139)),g=(a(662),a(663),a(664),a(665),a(644)),v=a(166),y=a(41),b=a(215),_=a(68),w=a(27),S=a.n(w),k={date_from:S()(),date_to:S()().subtract(7,"days"),sidebar_element:null,loaded_layers:!1,stub_data:[]};var E={loggedIn:!1,user:{},permissions:{},jwt:"",initialized:!1};var z=a(69),O={layersWfs:[],layerWms:[]};var j={grids:[],panels:[]};var C=Object(b.c)({GlobalStore:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case"SET_TIMEABLE":return Object(_.a)({},e,{date_from:t.date_from,date_to:t.date_to});case"LOADED_LAYERS":return Object(_.a)({},e,{loaded_layers:!0});case"LOADED_DATA":return Object(_.a)({},e,{stub_data:t.data});case"OPEN_SIDEBAR":return Object(_.a)({},e,{sidebar_element:t.element});default:return e}},UserStore:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case"SET_USER_STORE":return Object(_.a)({},E,t.obj);case"USER_STORE_LOGIN":return Object(_.a)({},e,{loggedIn:!0,jwt:t.token});case"USER_STORE_SET_USER":return Object(_.a)({},e,{user:t.user});case"LOGOUT":return Object(_.a)({},e,{loggedIn:!1,user:{},jwt:"",notifications:0});default:return e}},LayerStore:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case"ADD_LAYER":switch(t.layer.type){case"wfs":return Object(_.a)({},e,{layerWfs:[].concat(Object(z.a)(e.layerWfs),[t.layer])});default:return Object(_.a)({},e,{layerWms:[].concat(Object(z.a)(e.layerWfs),[t.layer])})}break;case"SET_LAYERS":return Object(_.a)({},e,{layerWfs:t.layerWfs,layerWms:t.layerWms});default:return e}},SearchStore:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case"ADD_GRID":return Object(_.a)({},e,{grids:[].concat(Object(z.a)(e.grids),[t.grid])});case"REMOVE_GRID":return Object(_.a)({},e,{grids:e.grids.filter(function(e){return e.id!==t.id})});case"ADD_PANEL":return Object(_.a)({},e,{panels:[].concat(Object(z.a)(e.panels),[t.panel])});case"REMOVE_PANEL":return Object(_.a)({},e,{panels:e.panels.filter(function(e){return e.id!==t.id})});case"GRID_":return Object(_.a)({},e,{grid:e.grids.map(function(e){return e.id===t.id&&(e.position=null),e})});case"GRID_TO_LEFT":var a=e.grids.map(function(e){return e.position&&"left"===e.position&&(e.position=null),e.id===t.id&&(e.position="left"),e});return Object(_.a)({},e,{panels:e.panels.map(function(e){return"left"===e.position&&(e.position=null),e}),grids:a});case"GRID_TO_RIGHT":var n=e.grids.map(function(e){return e.position&&"right"===e.position&&(e.position=null),e.id===t.id&&(e.position="right"),e});return Object(_.a)({},e,{panels:e.panels.map(function(e){return"right"===e.position&&(e.position=null),e}),grids:n});case"PANEL_":return Object(_.a)({},e,{panels:e.panels.map(function(e){return e.id===t.id&&(e.position=null),e})});case"PANEL_TO_LEFT":var r=e.panels.map(function(e){return e.position&&"left"===e.position&&(e.position=null),e.id===t.id&&(e.position="left"),e});return Object(_.a)({},e,{grids:e.grids.map(function(e){return"left"===e.position&&(e.position=null),e}),panels:r});case"PANEL_TO_RIGHT":var o=e.panels.map(function(e){return e.position&&"right"===e.position&&(e.position=null),e.id===t.id&&(e.position="right"),e});return Object(_.a)({},e,{grids:e.grids.map(function(e){return"right"===e.position&&(e.position=null),e}),panels:o});default:return e}}}),P=a(625),x=a.n(P),L=a(11),F=(a(595),a(232)),R=a(79),G=a.n(R),N=(a(345),a(113)),T=a(1011),D=function(){function e(t){Object(u.a)(this,e),this.successCallback=null,this.errorCallback=null,this.progressCallback=null,this.withFile=!1,this.params={},this.data={},this.file=null,this.instance=null}return Object(p.a)(e,[{key:"makeRequest",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"get",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"/",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;e.withFile&&(this.withFile=!0),this.successCallback=o,this.errorCallback=i,this.progressCallback=s,this.params=e,this.data=t,this.file=a,this.instance=T.create({baseURL:window.base_api_url+r,timeout:9e4,headers:Object(_.a)({},T.defaults.headers)}),this.doCall(r,n)}},{key:"doCall",value:function(){var e=Object(c.a)(l.a.mark(function e(t,a){var n,r,o,i=this;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n={method:"get_file"===a?"get":a,headers:Object(_.a)({},T.defaults.headers,{Authorization:localStorage.getItem("token")?"Bearer "+localStorage.getItem("token"):null}),params:this.params,data:this.data,responseType:"get_file"===a?"blob":"json",onUploadProgress:function(e){this.progressCallback&&this.progressCallback()},maxRedirects:0},this.file&&(r=new FormData,Array.isArray(this.file)?this.file.map(function(e,t,a){return r.append("file["+t+"]",e.file)}):r.append("file",this.file.file),(o=Object.keys(this.data)).length>0&&o.length>0&&o.map(function(e){return"string"===typeof i.data[e]||"number"===typeof i.data[e]?r.append(e,i.data[e]):r.append(e,JSON.stringify(i.data[e])),1}),n.headers=Object(_.a)({},n.headers,{"content-type":"multipart/form-data"}),n.data=r),this.instance.request(n).then(function(){var e=Object(c.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i.successCallback&&i.successCallback(t);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(){var e=Object(c.a)(l.a.mark(function e(t){var a,n,r,o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=!1,n=t.response&&t.response.data&&t.response.data.data?t.response.data.data:"";try{t.response&&t.response.data&&t.response.data.message&&(422==t.response.status?(r=JSON.parse(t.response.data.message),Object.keys(r).map(function(e){N.a.error(r[e])}),a=!0):(a=!0,N.a.error(t.response.data.message)))}catch(s){a=!0,N.a.error(t.response.data.message)}if(n.error&&(a=!0,"Unauthenticated."!==n.error&&N.a.error(n.error)),n.errors)try{Object.keys(n.errors).map(function(e){return n.errors[e].map(function(e){return a=!0,N.a.error(e),1}),1})}catch(t){a=!0,N.a.error("Errore")}if(n.message&&!a&&(a=!0,"Unauthenticated."!==n.message))try{o=JSON.parse(n.message),Object.keys(o).map(function(e){return o[e].map(function(e){return a=!0,N.a.error(e),1}),1})}catch(t){a=!0,N.a.error(n.message)}a||N.a.error("Errore non definito"),i.errorCallback&&i.errorCallback(t);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"parseBlob",value:function(){var e=Object(c.a)(l.a.mark(function e(t){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.readFile(t);case 3:return a=e.sent,e.abrupt("return",JSON.parse(a).data);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return","");case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t){return e.apply(this,arguments)}}()},{key:"readFile",value:function(){var e=Object(c.a)(l.a.mark(function e(t){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new FileReader,e.abrupt("return",new Promise(function(e,n){a.onerror=function(){a.abort(),n(new Error("Problem parsing file"))},a.onload=function(){e(a.result)},a.readAsText(t)}));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),I=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(new D).makeRequest({},{},null,"get","map/stub/layers",e,t||null,null)},A=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(new D).makeRequest({},{},null,"get","map/stub/data",e,t||null,null)},M=a(365),q=a(349),Y=a(468),V=a(115),U=a(106),W=a(271),B=a(477),X=a(472),H=a(478),K=a(43),J=a(38),Z=a(306),$=a(179),Q=a(193),ee=a(132),te=a(827),ae=a(1142),ne=a(50),re=a(626),oe=a.n(re),ie=a(627),se=a.n(ie),le=new $.default({color:"rgb(255,180,121)"}),ce=new Q.default({color:"#cc2e38",width:2}),ue=new ee.default({image:new ne.default({fill:le,stroke:ce,radius:5}),fill:le,stroke:ce}),pe=new ee.default({stroke:new Q.default({color:"rgba(0, 0, 255, 1.0)",width:2})}),de=new ee.default({image:new ne.default({fill:le,stroke:ce,radius:5}),fill:le,stroke:ce}),he={buildElicotteroRealTimeStyle:function(e,t){return function(e,t){var a=e.get("opacity"),n=.05/parseInt(t)*20;return n>.05&&(n=.05),new ee.default({zIndex:1==a?9:5,text:1==a?new te.default({fill:new $.default({color:"#0000FF"}),stroke:new Q.default({color:"#fff",width:2}),text:e.get("device_name"),font:"Tahoma, Courier New, monospace",offsetX:0,offsetY:20}):null,image:new ae.default({anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",scale:n,opacity:a,rotation:e.get("course")*(3.14/180),src:1==a?oe.a:se.a})})}(e,t)},buildWfsStyle:function(e,t){return function(e,t){var a=e.getGeometry();switch(console.log("geometry",a),a){case"Point":return ue;case"LineString":case"LinearRing":return pe;case"Polygon":return de;case"MultiPoint":return ue;case"MultiLineString":return pe;case"MultiPolygon":return de;case"GeometryCollection":return ue;case"Circle":return de}}(e)}},me=a(628),fe=a.n(me),ge=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e)return!1;try{if(a&&e.state_.visible||!a&&(e.state_.visible||!e.state_.visible)){var n=!0;return t.map(function(t){e.get(t[0])!==t[1]&&(n=!1)}),!!n&&e}return!1}catch(r){return console.log(r),!1}},ve=function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];return t.get("layers").array_.map(function(t){if(t instanceof U.default){var o=e(t,a,n);o&&(r=[].concat(Object(z.a)(r),Object(z.a)(o)))}else if("undefined"!==typeof t){var i=ge(t,a,n);i&&r.push(i)}}),r.length>0&&r},ye=(W.default,B.a,X.a,H.a,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a={LAYERS:e.identifier,TILED:!0},n=[];if(e.defaultSearchParams&&e.defaultSearchParams.map(function(e){n.push(e.join(""))}),t&&t.map(function(e){n.push(e.join(""))}),e.timeable){var r=$n.getState(),o=r.GlobalStore.date_from.format("YYYY-MM-DD"),i=r.GlobalStore.date_to.format("YYYY-MM-DD");n.push(e.time_field+">"+o+" AND "+e.time_field+"<"+i)}return n.length>0&&(a.cql_filter=n.join(" AND ")),a}),be=function(e,t){switch(e){case"TileWMS":return new M.default(t);case"OlSourceOsm":return new B.a(t);case"OlSourceArcGIS":return new X.a(t);case"BingMaps":return new H.a(t)}},_e=function(e){var t=new U.default({name:e.name});return e.activable&&t.set("activable",e.activable),e.layers.map(function(e){t.getLayers().getArray().push(we(e))}),t},we=function(e){switch(e.type){case"group":return _e(e);case"wms":return function(e){var t=new W.default({visible:e.visible||!1,name:e.name,opacity:e.opacity?parseFloat(e.opacity):1,source:new M.default({url:e.url+"wms",params:ye(e),serverType:"geoserver",transition:0,crossOrigin:"anonymous"})});return t.set("identifier",e.identifier),t.set("type",e.type),e.searchable&&t.set("searchable",e.searchable),e.refreshable&&t.set("refreshable",e.refreshable),e.timeable&&(t.set("timeable",!0),t.set("time_field",e.time_field)),e.legendable&&t.set("legendable",e.legendable),t.set("configuration_object",e),e.activable&&t.set("activable",e.activable),t}(e);case"image":return function(e){var t=new q.default({visible:e.visible||!1,name:e.name,opacity:e.opacity?parseFloat(e.opacity):1,source:new Y.default({url:e.url+"wms",params:ye(e),serverType:"geoserver",transition:0,crossOrigin:"anonymous"})});return t.set("identifier",e.identifier),t.set("type",e.type),e.searchable&&t.set("searchable",e.searchable),e.refreshable&&t.set("refreshable",e.refreshable),e.timeable&&(t.set("timeable",!0),t.set("time_field",e.time_field)),e.legendable&&t.set("legendable",e.legendable),t.set("configuration_object",e),e.activable&&t.set("activable",e.activable),t}(e);case"wfs":return function(e){var t=new K.default({name:e.name,visible:e.visible||!1,style:he.buildWfsStyle,source:new J.default({format:new V.default,opacity:e.opacity?parseFloat(e.opacity):1,url:function(t){var a=e.url+"ows?service=WFS&version=1.1.0&request=GetFeature&typename="+e.identifier+"&outputFormat=application/json&srsname=EPSG:4326",n=ye(e).cql_filter;return n&&""!=n&&(a+="&cql_filter="+n),a},strategy:Z.b})});return t.set("identifier",e.identifier),t.set("type",e.type),e.searchable&&t.set("searchable",e.searchable),e.refreshable&&t.set("refreshable",e.refreshable),e.activable&&t.set("activable",e.activable),e.timeable&&(t.set("timeable",!0),t.set("time_field",e.time_field)),e.legendable&&t.set("legendable",e.legendable),t.set("configuration_object",e),t}(e);case"elicottero":return function(e){var t=new K.default({name:e.name,legendUrl:fe.a,visible:e.visible||!1,style:he.buildElicotteroRealTimeStyle,source:new J.default({projection:e.projection||"EPSG:4326",format:new V.default,opacity:e.opacity?parseFloat(e.opacity):1,url:e.url,strategy:Z.b})});return t.set("identifier",e.identifier),t.set("type",e.type),e.searchable&&t.set("searchable",e.searchable),e.refreshable&&t.set("refreshable",e.refreshable),e.activable&&t.set("activable",e.activable),e.timeable&&(t.set("timeable",!0),t.set("time_field",e.time_field)),e.legendable&&t.set("legendable",e.legendable),t.set("configuration_object",e),t}(e);case"tile":return function(e){var t=new W.default({visible:e.visible||!1,source:be(e.source_type,e.source_config),name:e.name,crossOrigin:"anonymous"});return t.set("type",e.type),e.legendable&&t.set("legendable",e.legendable),t.set("configuration_object",e),t}(e)}},Se=function(e){I(function(t){t.data;t.data.map(function(t){var a=we(t);e.addLayer(a)}),$n.dispatch({type:"LOADED_LAYERS"})},function(e){console.log(e)})},ke=function(e){var t=[];return e.getLayers().array_.map(function(e){if(e instanceof U.default){var a=ve(e,[["legendable",!0]]);a&&(t=[].concat(Object(z.a)(t),Object(z.a)(a)))}else{var n=ge(e,[["legendable",!0]]);n&&t.push(n)}}),t},Ee=function(e){var t=[];return e.getLayers().array_.map(function(e){if(e instanceof U.default){var a=ve(e,[["timeable",!0]]);a&&(t=[].concat(Object(z.a)(t),Object(z.a)(a)))}else{var n=ge(e,[["timeable",!0]]);n&&t.push(n)}}),t},ze=function(e){var t=[];return e.getLayers().array_.map(function(e){if(e instanceof U.default){var a=ve(e,[["searchable",!0]]);a&&(t=[].concat(Object(z.a)(t),Object(z.a)(a)))}else{var n=we(e);n&&t.push(n,[["searchable",!0]])}}),t},Oe=function(e){var t=[];return e.getLayers().array_.map(function(e){if(e instanceof U.default){e.get("activable")&&t.push(e);var a=ve(e,[["activable",!0]]);a&&(t=[].concat(Object(z.a)(t),Object(z.a)(a)))}else{var n=ge(e,[["activable",!0]]);n&&t.push(n)}}),t},je=function(e){var t=[];return e.getLayers().array_.map(function(e){if(e instanceof U.default){"tile"===e.get("type")&&t.push(e);var a=ve(e,[["type","tile"]],!1);a&&(t=[].concat(Object(z.a)(t),Object(z.a)(a)))}else{var n=ge(e,[["type","tile"]],!1);n&&t.push(n)}}),t},Ce=function(e){!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=[];e.getLayers().array_.map(function(e){if(e instanceof U.default){var n=ve(e,[["refreshable",t]],!0);n&&(a=[].concat(Object(z.a)(a),Object(z.a)(n)))}else{var r=ge(e,[["refreshable",t]],!0);r&&a.push(r)}}),a.map(function(e){if(e.get("refreshable")){var t=e.get("type");if("wms"===t){var a=ye(e.get("configuration_object"));a.t=S()().format("X"),e.getSource().updateParams(a)}else"wfs"!==t&&"elicottero"!=t||e.getSource().clear(!0)}}),e.updateSize()}(e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1])},Pe=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={marks:{},min:{},max:{},current:[],loaded:!1},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){for(var e=S()(),t=S()().subtract(365,"d"),a={},n=parseInt(t.format("YYYY")),r=e.diff(t,"years"),o=1;o<=r;o++){var i=parseInt(n)+o;a[parseInt(S()(i,"YYYY").format("X"))]={style:{color:"#fff",backgroundColor:"rgba(0,0,0,.4)",fontSize:12,padding:"2px 4px"},label:""+i}}this.setState({min:t,max:e,current:[t.format("X"),e.format("X")],marks:a,loaded:!0})}},{key:"confirm",value:function(){var e=this;$n.dispatch({type:"SET_TIMEABLE",date_from:S()(parseInt(this.state.current[0]),"X"),date_to:S()(parseInt(this.state.current[1]),"X")}),this.setState({to_reload:!1}),setTimeout(function(){var t=Ee(e.props.map);console.log("visibili",t),t.map(function(e){if("wms"===e.get("type")){var t=ye(e.get("configuration_object"));e.getSource().updateParams(t)}else e.get("source").clear();return e}),e.props.map.updateSize()},500)}},{key:"onChange",value:function(e){e[0]>e[1]&&(e=[e[1],e[0]]),this.setState({current:e,to_reload:!0})}},{key:"getOneWeekAgo",value:function(){var e=S()(this.state.max.format("X"),"X");return parseInt(e.subtract(7,"d").format("X"))}},{key:"render",value:function(){var e=this;return this.state.loaded?r.a.createElement("div",{style:{}},r.a.createElement("div",{style:{width:"210px",float:"left",marginLeft:12,height:"35px",lineHeight:"35px"}},r.a.createElement("span",{style:{backgroundColor:"rgba(0,0,0,.4)",fontSize:12,color:"#fff",padding:"2px 5px"}},S()(parseInt(this.state.current[0]),"X").format("DD/MM/YYYY")," - ",S()(parseInt(this.state.current[1]),"X").format("DD/MM/YYYY")),this.state.to_reload?r.a.createElement(G.a,{type:"primary",icon:"arrow-up",onClick:function(){return e.confirm()},style:{color:"#fff",borderColor:"#fff",marginLeft:10},ghost:!0,size:"small"}):null),r.a.createElement("div",{style:{width:"50%",float:"left"}},r.a.createElement(F.default,{range:!0,marks:this.state.marks,onAfterChange:function(t){return e.onChange(t)},tipFormatter:function(e){return S()(e,"X").format("DD-MM-YYYY")},included:!0,defaultValue:[this.getOneWeekAgo(),parseInt(this.state.max.format("X"))],min:parseInt(this.state.min.format("X")),max:parseInt(this.state.max.format("X")),step:86400}))):null}}]),t}(n.Component),xe=(a(346),a(153)),Le=(a(604),a(156)),Fe=a(375),Re=a.n(Fe),Ge=function(){function e(){Object(u.a)(this,e),this.string="",this.array_string=[],this.index_to_splice=[],this.comma_index=[],this.found_civico=!1,this.found_cap=!1,this.states=["RM","LT","RI","VT","FR","RC"],this.result={prefix:"",street:"",number:null,cap:null,city:null,state:null},this.connectors=["di","a","da","in","con","su","per","tra","fra","del","dei","dell","della","dello","col","coi","sul","sui","sull","sulla","sullo"],this.distance_connector=["km"],this.prefixes=["via","piazza","pzza","strada","strda","viale"]}return Object(p.a)(e,[{key:"clear",value:function(){this.string="",this.array_string=[],this.index_to_splice=[],this.comma_index=[],this.found_civico=!1,this.found_cap=!1,this.result={prefix:"",street:"",number:null,cap:null,city:null,state:null}}},{key:"parse",value:function(e){this.clear(),e=this.cleanString(e),this.string=e,this.makeArray("array_string",e),this.parseArray("array_string"),this.makeFinalStreet("array_string")}},{key:"makeFinalStreet",value:function(e){this.spliceUsedIndex(e),this.result.street=this[e].join(" ")}},{key:"spliceUsedIndex",value:function(e){var t=this;this.index_to_splice.sort().reverse(),this.index_to_splice.map(function(a){return t[e].splice(a,1),a})}},{key:"cleanString",value:function(e){return e=(e=(e=(e=(e=(e=(e=e.replace(/\,\,/g,",")).replace(/\,/g," , ")).replace(/  /g," ")).replace(/\'/g," ")).replace(/\"/g,"")).replace(/\(/g,"")).replace(/\)/g,"")}},{key:"makeArray",value:function(e,t){this[e]=t.split(" "),this[e]=this.cleanArray(this[e])}},{key:"cleanArray",value:function(e){return e.map(function(t,a,n){t&&""!==t&&" "!==t||e.splice(a,1)}),e}},{key:"parseArray",value:function(e){var t=this;this[e].map(function(e,a,n){t.identifyElement(e,a,n)})}},{key:"identifyElement",value:function(e,t,a){if(!this.isComma(e,t,a))if(this.isCap(e,t,a))this.result.cap=e;else{var n=this.isCivico(e,t,a);n?this.result.number=n:this.isCity(e,t,a)||(a[t+1]&&this.isConnector(a[t+1],t+1,a)||a[t-1]&&this.isConnector(a[t-1],t-1,a))&&!n||(this.isPrefix(e,t,a)?this.result.prefix=e:this.isState(e,t,a)&&(this.result.state=e))}}},{key:"isPrefix",value:function(e,t,a){return-1!==this.prefixes.indexOf(e.toLowerCase())&&t<2&&(this.index_to_splice.push(t),!0)}},{key:"isCap",value:function(e,t,a){return!!(e.match(/^0[0-9]{0,4}$/)&&e.length<=5)&&(this.index_to_splice.push(t),this.found_cap=!0,!0)}},{key:"isConnector",value:function(e,t,a){return-1!==this.connectors.indexOf(e)}},{key:"isCivico",value:function(e,t,a){if("0"===e[0])return!1;var n=null,r="^([0-9]{1,}$)|^([0-9]{1,}[-/\\]{1}[0-9]{1,})|^([0-9]{1,}[a-zA-Z]{1,1}$)|^([0-9]{1,}$)";return this.distance_connector.map(function(e,t,a){return r+="|^("+e+"[0-9]{1,}$)",e}),e.match(new RegExp(r))?(n=e,this.index_to_splice.push(t),!e.match(/([0-9]{1,}[a-zA-Z]{1,1}$)/)&&a[t+1]&&a[t+1].match(/^([a-zA-Z]{1,1}$)/)&&(n=e+a[t+1],a.splice(t+1,1)),this.found_civico=!0,n):-1!==this.distance_connector.indexOf(e)&&(this.found_civico=!0,this.index_to_splice.push(t),n=e,a[t+1]&&a[t+1].match(new RegExp(r))&&(n=e+a[t+1],a.splice(t+1,1)),n)}},{key:"isComma",value:function(e,t,a){return","===e&&(this.index_to_splice.push(t),this.comma_index.push(t),!0)}},{key:"isState",value:function(e,t,a){return-1!==this.states.indexOf(e.toUpperCase())&&(this.index_to_splice.push(t),!0)}},{key:"isCity",value:function(e,t,a){if(this.isState(e,t,a))return!1;var n=a.length/100*60,r=!1,o=0;return this.result.city&&(o-=10),t>=n&&(o+=40),t>=a.length-2&&(o+=10),e[0]&&e[0]===e[0].toUpperCase()&&(o+=10),(this.found_cap||this.found_civico)&&(o+=40),!this.found_cap||this.result.prefix&&""!==this.result.prefix||(o+=20),-1!==this.prefixes.indexOf(a[t+1])&&(o+=10),this.isConnector(a[t-1],t-1,a)&&(r=!0,o+=20),-1!==this.comma_index.indexOf(t-1)&&(o+=40),-1!==this.comma_index.indexOf(t-2)&&(o+=30),-1!==this.comma_index.indexOf(t-3)&&(o+=20),0===this.comma_index.length&&this.result.prefix&&""!==this.result.prefix&&(o-=100),o>=60&&(r?(this.result.city=a[t-2]+" "+a[t-1]+" "+e,this.index_to_splice.push(t),this.index_to_splice.push(t-1),this.index_to_splice.push(t-2)):(this.result.city=this.result.city&&""!==this.result.city?this.result.city+" "+e:e,this.index_to_splice.push(t)),!0)}},{key:"compare",value:function(e,t){}}]),e}(),Ne=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(new D).makeRequest(e,{},null,"get","map/autocomplete/search",t,a||null,null)},Te=function(){function e(){Object(u.a)(this,e),this.endpoint="",this.token="",this.string="",this.current_obj={prefix:"",street:"",number:null,cap:null,city:null,state:null},this.temp_obj={prefix:"",street:"",number:null,cap:null,city:null,state:null},this.results_array=[],this.calling=!1,this.changed=!1}return Object(p.a)(e,[{key:"_set",value:function(e,t){this[e]=t}},{key:"_get",value:function(e){return this[e]}},{key:"loadResult",value:function(e,t){var a=this;this.temp_obj=e,this.string=t,this.shouldCall()&&setTimeout(function(){return a.callService(t)},500)}},{key:"callService",value:function(e){var t=this;this.string!=e||this.calling||(this.calling=!0,Ne(this.makeQString(),function(e){t.calling=!1,t.setResults(e.data)}))}},{key:"setResults",value:function(e){this.current_obj=this.temp_obj,e.length>0&&(this.results_array=e,this.cb(this.results_array))}},{key:"filterResults",value:function(e){var t=this,a=[],n=!1;if(this.current_obj.number&&!n){var r=this.current_obj.street.toLowerCase(),o=e.find(function(e){return e.via.toLowerCase().match(new RegExp(r.toLowerCase().trim(),"gi"))});o&&(JSON.parse(o.civici).map(function(e){console.log("civico",e),e.civico==t.current_obj.number&&a.push({full_address:o.via+" "+e.civico+", "+e.cap+" "+o.comune+" ("+o.provincia+")",address:o.via+" "+e.civico+" "+o.comune+" "+o.provincia,lat:e.lat,lon:e.lon})}),0==a.length&&(a.push({full_address:o.via+" "+this.current_obj.number+", "+JSON.parse(o.civici)[0].cap+" "+o.comune+" ("+o.provincia+") - approssimativo -",address:o.via+" "+this.current_obj.number+" "+o.comune+" "+o.provincia,lat:JSON.parse(o.civici)[0].lat,lon:JSON.parse(o.civici)[0].lon}),JSON.parse(o.civici).map(function(e,t,n){t>3||a.push({full_address:o.via+" "+e.civico+", "+e.cap+" "+o.comune+" ("+o.provincia+")",address:o.via+" "+e.civico+" "+o.comune+" "+o.provincia,lat:e.lat,lon:e.lon})}))),n=!0}return n||e.map(function(e){switch(e.type){case 1:a.push({full_address:e.via+", "+JSON.parse(e.civici)[0].cap+" "+e.comune+" ("+e.provincia+") - approssimativo -",address:e.via+" "+e.comune+" "+e.provincia,lat:JSON.parse(e.civici)[0].lat,lon:JSON.parse(e.civici)[0].lon});break;case 2:case 3:default:a.push({full_address:e.full_address,address:e.full_address,lat:e.lat,lon:e.lon})}}),a}},{key:"shouldCall",value:function(){this.compareObjs();return!this.calling}},{key:"compareObjs",value:function(){var e=this,t=0;return Object.keys(this.current_obj).map(function(a){e.current_obj[a]!=e.temp_obj[a]&&t++}),t>0}},{key:"localLike",value:function(){}},{key:"makeQString",value:function(){var e="",t={};return this.temp_obj.prefix&&(e+=this.temp_obj.prefix),this.temp_obj.street&&(e+=" "+this.temp_obj.street),(this.temp_obj.cap&&!this.temp_obj.street||""==this.temp_obj.street)&&(e=this.temp_obj.cap),this.temp_obj.city&&(e+=", "+this.temp_obj.city),t.address=e,this.temp_obj.city&&""!=this.temp_obj.city&&(t.c=this.temp_obj.city),this.temp_obj.state&&""!=this.temp_obj.state&&(t.pr=this.temp_obj.state),console.log("obj",t),t}}]),e}(),De=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={loaded:!1,has_google:!1,usage:"",address:"",parser:new Ge,caller:new Te,local_results:[]},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.state.caller.cb=function(t){e.updateLocalResults(t)},window.google&&this.setState({has_google:!0,usage:"g"})}},{key:"handleAddressChange",value:function(e){this.setState({address:e})}},{key:"componentWillReceiveProps",value:function(e){e.address!==this.props.address&&this.setState({address:e.address})}},{key:"onAddressSelect",value:function(e){var t=this;console.log(e),Object(Fe.geocodeByAddress)(e).then(function(e){return Object(Fe.getLatLng)(e[0])}).then(function(e){var a=e.lat,n=e.lng,r=Object(L.fromLonLat)([n,a],"EPSG:3857");t.props.map.getView().setCenter(r)})}},{key:"onSearchLocal",value:function(e){this.setState({address:e}),this.state.parser.parse(e),this.state.caller.loadResult(this.state.parser.result,e)}},{key:"selectAddress",value:function(e){this.props.map.getView().setCenter(Object(L.fromLonLat)([e.lon,e.lat],"EPSG:3857")),this.setState({address:e.full_address,local_results:[]})}},{key:"updateLocalResults",value:function(e){this.setState({local_results:e})}},{key:"render",value:function(){var e=this,t=this.state.address;return r.a.createElement(r.a.Fragment,null,this.state.has_google?r.a.createElement(Le.a.Group,{onChange:function(t){return e.setState({usage:t.target.value})},defaultValue:"g",size:"small",style:{marginLeft:24}},r.a.createElement(Le.a.Button,{value:"g"},"Google"),r.a.createElement(Le.a.Button,{value:"l"},"Locale")):null,"g"===this.state.usage?r.a.createElement(Re.a,{onChange:function(t){return e.handleAddressChange(t)},onSelect:function(t){return e.onAddressSelect(t)},value:t},function(e){var t=e.getInputProps,a=e.getSuggestionItemProps,n=e.suggestions,o=e.loading;return r.a.createElement(r.a.Fragment,null,r.a.createElement(xe.default,Object.assign({},t({id:"address-input"}),{className:"autocomplete-input"})),r.a.createElement("div",{className:"autocomplete-dropdown-container"},o?r.a.createElement("div",null,"Loading..."):null,n.map(function(e){var t=e.active?"suggestion-item--active":"suggestion-item",n=e.active?{backgroundColor:"#fafafa",cursor:"pointer",padding:25}:{backgroundColor:"#ffffff",cursor:"pointer"},o=Object(_.a)({},a(e,{className:t,style:n}));return r.a.createElement("div",Object.assign({},o,{key:e.id}),r.a.createElement("div",null,e.description))})))}):r.a.createElement(r.a.Fragment,null,r.a.createElement(xe.default,{onChange:function(t){return e.onSearchLocal(t.target.value)},value:this.state.address,className:"autocomplete-input"}),r.a.createElement("div",{className:"autocomplete-dropdown-container"},this.state.caller&&this.state.caller.filterResults(this.state.local_results).map(function(t,a,n){return r.a.createElement("div",{key:"local_addr_"+a,className:"suggestion-item",onClick:function(a){return e.selectAddress(t)}},t.full_address)}))))}}]),t}(n.Component),Ie=(a(229),a(123)),Ae=a(46),Me=a(629),qe=a.n(Me),Ye=a(239),Ve=a(66),Ue=a(273),We=a(368),Be=a(157);function Xe(e){return He.apply(this,arguments)}function He(){return(He=Object(c.a)(l.a.mark(function e(t){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all(Object(z.a)(t.map(function(e){return fetch(e[1]).then(function(e){return e.json()})})));case 3:return a=e.sent,e.abrupt("return",a);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",null);case 10:case"end":return e.stop()}},e,null,[[0,7]])}))).apply(this,arguments)}var Ke={searchFeatures:function(){var e=Object(c.a)(l.a.mark(function e(t,a,n,r){var o,i,s,u,p,d,h,m,f,g,v,y=arguments;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=y.length>4&&void 0!==y[4]?y[4]:null,i=y.length>5?y[5]:void 0,s=ze(r),u=[],p=[],d=[],h=[],Be.default.defs("EPSG:6876","+proj=tmerc +lat_0=0 +lon_0=12 +k=1 +x_0=3000000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),Be.default.defs("EPSG:3004","+proj=tmerc +lat_0=0 +lon_0=15 +k=0.999600 +x_0=2520000 +y_0=0 +ellps=intl +units=m +no_defs"),Be.default.defs("EPSG:32632","+proj=utm +zone=32 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"),Be.default.defs("EPSG:32633","+proj=utm +zone=33 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"),Be.default.defs("EPSG:25833","+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),Be.default.defs("EPSG:23033","+proj=utm +zone=33 +ellps=intl +units=m +no_defs"),Object(We.a)(Be.default),m={"EPSG:6876":Object(L.get)("EPSG:6876"),"EPSG:3004":Object(L.get)("EPSG:3004"),"EPSG:32632":Object(L.get)("EPSG:32632"),"EPSG:32633":Object(L.get)("EPSG:32633"),"EPSG:25833":Object(L.get)("EPSG:25833"),"EPSG:23033":Object(L.get)("EPSG:23033")},f=i.getGeometry(),g=new Ue.a,f instanceof Ye.a&&(f=Object(Ve.c)(f)).transform("EPSG:3857","EPSG:4326"),v=g.writeGeometryText(f),s.map(function(){var e=Object(c.a)(l.a.mark(function e(r){var o,i,s,c,u,h,y,b,_,w;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=r.get("configuration_object"),i=o.projection?o.projection:"EPSG:4326",s=o.projection&&m[o.projection]?m[o.projection]:"EPSG:4326",c=f.clone().transform("EPSG:4326",s),v=g.writeGeometryText(c),u="","wms"==r.get("type")||"image"==r.get("type")?(r.getSource().params_.cql_filter&&(u+=r.getSource().params_.cql_filter),"undefined"!==typeof u&&"undefined"!==u&&u&&""!=u?u+=" AND ":u="",h=r.get("identifier"),y=r.get("name"),b=o.geom_field?o.geom_field:"geom",o.feature_type&&"polygon"===o.feature_type?p.push([y,o.url+"/wfs?version=1.0.0&request=GetFeature&srsName="+i+"&typeName="+h+"&outputFormat=application%2Fjson&cql_filter="+u+"INTERSECTS("+b+","+v+")",h]):"WITHIN"===t?p.push([y,o.url+"/wfs?version=1.0.0&request=GetFeature&srsName="+i+"&typeName="+h+"&outputFormat=application%2Fjson&cql_filter="+u+t+"("+b+","+n+")",h]):(o.divide_query&&(a/=1e4),p.push([y,o.url+"/wfs?version=1.0.0&request=GetFeature&srsName="+i+"&typeName="+h+"&outputFormat=application%2Fjson&cql_filter="+u+t+"("+b+","+n+","+a+",meters)",h]))):(_=o.geom_field?o.geom_field:"geom",w=o.url+"ows?service=WFS&version=1.1.0&request=GetFeature&typename="+o.identifier+"&outputFormat=application/json&srsname=EPSG:4326",u=ye(o).cql_filter,w+=u&&""!=u?"&cql_filter="+u+" AND ":"&cql_filter=",o.feature_type&&"polygon"===o.feature_type?w+="INTERSECTS("+_+","+v+")":"WITHIN"===t?w+=t+"("+_+","+n+")":(o.divide_query&&(a/=1e4),w+=t+"("+_+","+n+","+a+",meters)"),d.push([r.get("name"),r.getSource().getFeatures(),r.get("identifier"),w]));case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.next=22,Xe(p);case 22:return u=e.sent,S()().format("X"),d.map(function(e){var t=[],a=[];if(e[1].map(function(e){e.getGeometry().intersectsExtent(o.getExtent())?(t.push(e),a.push(e.getId())):console.log("non intersezione")}),t.length>0){var n=new J.default({wrapX:!1});n.addFeatures(t),h.push({layer:e[2],layer_identifier:e[0],type:"wfs",query:e[3],features:n.getFeatures()})}}),u&&u.map(function(e,t,a){if(e.totalFeatures>0){var n=new J.default({wrapX:!1});e.features.map(function(e){var t=(new V.default).readFeatureFromObject(e);t.getGeometry().transform("EPSG:4326","EPSG:3857"),n.addFeature(t)}),h.push({layer:p[t][2],layer_identifier:p[t][0],type:"wms",query:p[t][1],features:n.getFeatures()})}}),e.abrupt("return",h);case 27:case"end":return e.stop()}},e)}));return function(t,a,n,r){return e.apply(this,arguments)}}(),searchOnPoint:function(){var e=Object(c.a)(l.a.mark(function e(t,a){var n,r,o,i,s,u,p;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=ze(a),r=a.getView().getResolution(),o=[],i=[],s=[],n.map(function(){var e=Object(c.a)(l.a.mark(function e(n){var i,c,u,p;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:"wms"==n.get("type")||"image"==n.get("type")?(i=n.get("identifier"),c=n.get("name"),n.get("configuration_object"),u=a.getView().getProjection(),p=n.getSource().getGetFeatureInfoUrl(t,r,u,{INFO_FORMAT:"application/json",FEATURE_COUNT:50}),o.push([c,p,i])):s.push([n.get("name"),n.getSource().getFeatures(),n.get("identifier"),""]);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),S()().format("X"),u=new Ye.a(t,50),u=Object(Ve.c)(u),s.map(function(e){var t=[],a=[];if(e[1].map(function(e){if(e.getGeometry().intersectsExtent(u.getExtent())){var n=e.getId();-1==a.indexOf(n)&&(t.push(e),a.push(e.getId()))}}),t.length>0){var n=new J.default({wrapX:!1});n.addFeatures(t),i.push({layer:e[2],layer_identifier:e[0],type:"wfs",query:e[3],features:n.getFeatures()})}}),e.next=12,Xe(o);case 12:return(p=e.sent)&&p.map(function(e,t,a){if(e.features.length>0){var n=new J.default({wrapX:!1});e.features.map(function(e){var t=(new V.default).readFeatureFromObject(e),a=t.getGeometry();a&&a.transform("EPSG:4326","EPSG:3857"),n.addFeature(t)}),i.push({layer:o[t][2],layer_identifier:o[t][0],type:"wms",query:o[t][1],features:n.getFeatures()})}}),e.abrupt("return",i);case 15:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),addGrid:function(e){$n.dispatch({type:"ADD_GRID",grid:e})},addPanel:function(e){$n.dispatch({type:"ADD_PANEL",panel:e})}},Je=a(47),Ze=(a(109),a(32)),$e=(a(347),a(165)),Qe=(a(1039),a(635)),et=(a(1041),a(636)),tt=(a(1042),a(645)),at=(a(1044),a(633)),nt=(a(605),a(372)),rt=(a(606),a(13)),ot=(a(1048),a(476)),it=(a(1146),a(378)),st=(a(617),a(126)),lt=(a(1052),a(377)),ct=(a(1143),a(243)),ut=a(473),pt=a.n(ut),dt=ct.a.MonthPicker,ht=ct.a.RangePicker,mt=(ct.a.WeekPicker,lt.a.Item),ft=st.default.Option,gt=Le.a.Button,vt=Le.a.Group,yt=it.a.Dragger,bt=ot.a.Step,_t=xe.default.TextArea,wt=["text","link","button","submit","title"],St=["datepicker","timepicker","datetimepicker","rangepicker"],kt=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={current_step:0},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){}},{key:"formatFieldRules",value:function(e){var t=this,a=[];return!e.validations||e.validations.length<=0?null:(e.validations.map(function(e){var n={};n="required"==e.type?{required:!0,message:e.error_message}:e.validator?{validator:t.props[e.validator]}:"check"==e.type?{validator:function(a,n,r){t.props.form.getFieldValue(e.check_field)!=n?r(e.error_message):r()}}:e,a.push(n)}),a)}},{key:"returnFieldInitialValue",value:function(e){var t=this,a="";return Object.keys(this.props.values).map(function(n){if(n==e.name)if(-1!=St.indexOf(e.type))switch(e.type){case"datepicker":a=S()(t.props.values[n],e.format||"DD/MM/YYYY").isValid()?S()(t.props.values[n],e.format||"DD/MM/YYYY"):S()(t.props.values[n],e.format||"YYYY-MM-DD");break;case"datetimepicker":a=S()(t.props.values[n],e.format||"DD/MM/YYYY HH:mm");break;case"timepicker":a=S()(t.props.values[n],e.format||"HH:mm");break;case"rangepicker":a=[S()(t.props.values[n],e.format||"DD/MM/YYYY HH:mm"),S()(t.props.values[n],e.format||"DD/MM/YYYY HH:mm")]}else a=t.props.values[n]?t.props.values[n]:null}),a||null}},{key:"returnSelectOptions",value:function(e){var t=[];return e.options&&e.options.length>0&&(t=e.options),e.optionsFunc&&(t=this.props[e.optionsFunc](e)),e.options_props&&(t=this.props[e.options_props]),t.map(function(t,a,n){return r.a.createElement(ft,{key:"option_"+e.name+"_"+a,value:t.value},t.label)})}},{key:"returnRadioGroupOptions",value:function(e){var t=[];return e.options&&e.options.length>0&&(t=e.options),e.optionsFunc&&(t=this.props[e.optionsFunc](e)),e.options_props&&(t=this.props[e.options_props]),t.map(function(t,a,n){return"button"==e.option_type?r.a.createElement(gt,{key:"radiooption_"+e.name+"_"+a,value:t.value},t.label):r.a.createElement(Le.a,{key:"radiooption_"+e.name+"_"+a,value:t.value},t.label)})}},{key:"returnFieldType",value:function(e,t){var a=this;switch(e.type){case"input":return r.a.createElement(xe.default,Object.assign({},e.props,{placeholder:e.placeholder?e.placeholder:"Inserisci il testo",type:e.type_string?e.type_string:"text"}));case"textarea":return r.a.createElement(_t,Object.assign({},e.props,{placeholder:e.placeholder?e.placeholder:"Inserisci il testo",type:e.type_string?e.type_string:"text"}));case"select":return r.a.createElement(st.default,Object.assign({},e.props,{onChange:this.props[e.onChange]?function(t){return a.props[e.onChange](t)}:null,onSelect:e.onSelectFunc?this.props[e.onSelectFunc]:null,mode:e.mode||null}),this.returnSelectOptions(e));case"radio":return r.a.createElement(vt,e.props,this.returnRadioGroupOptions(e));case"autocomplete":return r.a.createElement($e.default,Object.assign({},e.props,{dataSource:this.props[e.dataFunc](),style:{},onSelect:this.props[e.onSelectFunc],onSearch:this.props[e.onSearch]?function(t){return a.props[e.onSearch](t)}:null,placeholder:e.placeholder?e.placeholder:"Inserisci il testo"}),e.withIcon?r.a.createElement(xe.default,{suffix:r.a.createElement(rt.default,{type:"search",className:"certain-category-icon"})}):null);case"datepicker":return r.a.createElement(ct.a,Object.assign({},e.props,{placeholder:e.placeholder?e.placeholder:"Data",format:e.format||"DD/MM/YYYY"}));case"anno":for(var n=[],o=1940;o<=parseInt(S()().format("YYYY"));o++)n.push(""+o);return r.a.createElement(st.default,Object.assign({},e.props,{name:"y_"+e.name,onChange:null,mode:e.mode||null}),n.map(function(t){return r.a.createElement(ft,{key:"optiony_"+e.name+"_"+t,value:t},t)}));case"mese":var i=[];for(o=1;o<=12;o++)i.push(o<10?"0"+o:""+o);return r.a.createElement(st.default,Object.assign({},e.props,{name:"m_"+e.name,onChange:null,mode:e.mode||null}),i.map(function(t){return r.a.createElement(ft,{key:"optionm_"+e.name+"_"+t,value:t},t)}));case"giorno":var s=[];for(o=1;o<=31;o++)s.push(o<10?"0"+o:""+o);return r.a.createElement(st.default,Object.assign({},e.props,{name:"d_"+e.name,onChange:null,mode:e.mode||null}),s.map(function(t){return r.a.createElement(ft,{key:"optiond_"+e.name+"_"+t,value:t},t)}));case"timepicker":return r.a.createElement(ct.a,Object.assign({},e.props,{placeholder:e.placeholder?e.placeholder:"Ora",showTime:!0,format:e.format||"HH:mm"}));case"datetimepicker":return r.a.createElement(ct.a,Object.assign({},e.props,{placeholder:e.placeholder?e.placeholder:"Data e ora",showTime:!0,format:e.format||"DD/MM/YYYY HH:mm"}));case"monthpicker":return r.a.createElement(dt,Object.assign({},e.props,{format:e.format||"MM-YYYY",placeholder:e.placeholder?e.placeholder:["Mese inizio","Mese fine"]}));case"rangepicker":switch(e.range_type){case"month":return r.a.createElement(dt,Object.assign({},e.props,{mode:["month","month"],format:e.format||"MM-YYYY",placeholder:e.placeholder?e.placeholder:["Mese inizio","Mese fine"]}));default:var l=e.showTime?"DD/MM/YYYY HH:mm":"DD/MM/YYYY";return r.a.createElement(ht,Object.assign({},e.props,{showTime:e.showTime||!1,format:e.format||l,placeholder:e.placeholder?e.placeholder:["Data inizio","Data fine"]}))}break;case"numberinput":return r.a.createElement(nt.a,Object.assign({},e.props,{min:e.min||0,max:e.max||9999999}));case"switch":return r.a.createElement(at.a,null);case"rate":return r.a.createElement(tt.a,null);case"slider":return r.a.createElement(F.default,{vertical:e.vertical||!1,step:e.step||1,dots:e.dots||!1,min:e.min||1,max:e.max||9999999,marks:e.marks||{},tipFormatter:function(e){try{return e.toString()}catch(t){return""}}});case"upload":return r.a.createElement(yt,Object.assign({accept:e.accept||"*",action:e.action,listType:e.listType,multiple:e.multiple,fileList:this.props[e.fileList](),customRequest:this.props[e.customRequest],onRemove:this.props[e.onRemove]},e.props),r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(rt.default,{type:"inbox"})),r.a.createElement("p",{className:"ant-upload-text"},"Clicca qui o trascina file per caricarli"),r.a.createElement("p",{className:"ant-upload-hint"},e.text?e.text:"Inserisci uno pi\xf9 file"));case"square_upload":return r.a.createElement(it.a,Object.assign({accept:e.accept||"*",action:e.action,listType:e.listType,multiple:e.multiple,fileList:this.props[e.fileList](),customRequest:this.props[e.customRequest],onRemove:this.props[e.onRemove]},e.props),r.a.createElement("div",null,r.a.createElement(rt.default,{type:"plus",style:{fontSize:32}}),r.a.createElement("div",{className:"ant-upload-text"},e.text?e.text:"Carica una immagine")));case"simple_upload":return r.a.createElement(it.a,Object.assign({accept:e.accept||"*",action:e.action,listType:e.listType,multiple:!1,customRequest:this.props[e.customRequest],onRemove:this.props[e.onRemove]},e.props),r.a.createElement(Ze.default,null,r.a.createElement(rt.default,{type:"upload"}),e.text?e.text:"Carica"));default:return r.a.createElement(xe.default,null)}}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault(),this.props.form.validateFieldsAndScroll(function(e,a){e||(a=t.formatValues(a),t.props[t.props.form_model.onSubmit](a))})}},{key:"formatValues",value:function(e){return pt.a.forEach(e,function(t,a){"rangeMonth"==a&&pt.a.isArray(t)&&(e[a]={start:t[0].toISOString(),end:t[1].toISOString()})}),e}},{key:"renderNotFieldType",value:function(e){var t=this;switch(e.type){case"submit":return r.a.createElement(mt,{key:"form_not_item_"+e.name},r.a.createElement(Ze.default,Object.assign({loading:this.props.loading||!1},e.props||null,{type:e.btn_type||"primary",htmlType:"submit"}),e.text));case"button":return r.a.createElement(mt,{key:"form_not_item_"+e.name},r.a.createElement(Ze.default,Object.assign({},e.props||null,{type:e.btn_type||"primary",onClick:function(){return t.props[e.onClick](t.props.form)}}),e.text));case"text":return r.a.createElement("p",{key:"form_not_item_"+e.name},e.text);case"link":return r.a.createElement("p",Object.assign({},e.props||null,{key:"form_not_item_"+e.name}),r.a.createElement("a",{href:e.link||null,onClick:function(){t.props[e.onClick]&&t.props[e.onClick](t.props.form)}},e.text));case"title":switch(e.element){case"h1":return r.a.createElement("h1",Object.assign({key:"form_not_item_"+e.name},e.props||null),e.text);case"h2":return r.a.createElement("h2",Object.assign({key:"form_not_item_"+e.name},e.props||null),e.text);case"h3":return r.a.createElement("h3",Object.assign({key:"form_not_item_"+e.name},e.props||null),e.text);case"h4":return r.a.createElement("h4",Object.assign({key:"form_not_item_"+e.name},e.props||null),e.text);case"h5":return r.a.createElement("h5",Object.assign({key:"form_not_item_"+e.name},e.props||null),e.text)}}}},{key:"validateField",value:function(e){var t=this;if(!e.showIf)return!0;var a=!0;return e.showIf.map(function(n){switch(n.type){case"field_validation":switch(n.operator){case"==":case"===":a=t.props.form.getFieldValue(n.field)==n.value;break;case">":a=t.props.form.getFieldValue(n.field)>n.value;break;case"<":a=t.props.form.getFieldValue(n.field)<n.value;break;case">=":a=t.props.form.getFieldValue(n.field)>=n.value;break;case"<=":a=t.props.form.getFieldValue(n.field)<=n.value;break;case"!=":a=t.props.form.getFieldValue(n.field)!=n.value;break;default:a=!1}break;case"prop_func":t.props[n.func](t.props.form.getFieldValue(e.name),t.props.form,e.name)||(a=!1)}}),a}},{key:"passFunction",value:function(e){return this.refs.common_form[e]()}},{key:"render",value:function(){var e=this,t=this.props.form,a=t.getFieldDecorator;t.getFieldsError,t.getFieldError,t.isFieldTouched;return r.a.createElement(lt.a,{autoComplete:this.props.autocomplete||"off",layout:this.props.form_model.layout||"vertical",onSubmit:this.handleSubmit.bind(this)},this.props.form_model.multistep?r.a.createElement(ot.a,{current:this.props.current_step},this.props.form_model.steps.map(function(e){return r.a.createElement(bt,{key:"form_step_"+e.title,title:e.title})})):null,this.props.form_model.rows.map(function(t,n,o){return t.step&&e.props.current_step+1!=t.step?null:r.a.createElement(Qe.a,{gutter:t.gutter||8,key:"row_"+n},t.cols.map(function(n,o,i){return r.a.createElement(et.a,{lg:n.span||parseInt(24/t.cols.length),md:n.md||12,sm:n.sm||24,xs:n.xs||24,key:"col_"+o},n.items&&n.items.map(function(t){if(e.validateField(t))return-1!=wt.indexOf(t.type)?e.renderNotFieldType(t):r.a.createElement(mt,{hasFeedback:t.hasFeedback||!1,key:"form_item_"+t.name,label:t.label},a(t.name,{rules:e.formatFieldRules(t),initialValue:e.returnFieldInitialValue(t)})(e.returnFieldType(t,e.props.form)))}))}))}))}}]),t}(n.Component),Et=lt.a.create()(kt),zt=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(new D).makeRequest({},{},null,"get","map/evento/"+e,t,a||null,null)},Ot=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(new D).makeRequest({},t,null,"post","map/evento/"+e+"/change-position",a,n||null,null)},jt=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(new D).makeRequest({},e,null,"post","map/evento",t,a||null,null)},Ct=a(301),Pt=a(419),xt=$e.default.Option,Lt={layout:"vertical",multistep:!1,rows:[{cols:[{span:24,items:[{type:"select",label:"Stato",name:"stato",validations:[{type:"required",error_message:"Campo obbligatorio"}],options:[{value:"Non gestito",label:"Non gestito"},{value:"In gestione",label:"In gestione"},{value:"Chiuso",label:"Chiuso"}]}]}]},{cols:[{span:24,items:[{type:"select",label:"Tipologia",name:"tipologia_evento",validations:[{type:"required",error_message:"Campo obbligatorio"}],options_props:"tipologie",onSelectFunc:"selectTipologia"}]}]},{cols:[{span:24,items:[{type:"select",label:"Sottotipologia",name:"sottotipologia_evento",showIf:[{type:"prop_func",func:"notEmptyTipologia"}],options_props:"sottotipologie"}]}]},{cols:[{span:24,items:[{type:"autocomplete",label:"Comune",name:"idcomune",props:{},validations:[{type:"required",error_message:"Campo obbligatorio"}],withIcon:!0,dataFunc:"searchComune",onSearch:"searchingComune"}]}]},{cols:[{span:24,items:[{type:"input",label:"Indirizzo",name:"indirizzo"}]}]},{cols:[{span:24,items:[{type:"input",label:"Luogo",name:"luogo"}]}]},{cols:[{items:[{name:"submit",type:"submit",text:"Conferma",btn_type:"primary"}]}]}],onSubmit:"submitted"},Ft=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={loading:!1,comuni:[],id_tipologia:!1,open_form:!1},a.vectorSource=null,a.vectorLayer=null,a.feature=null,a.select=null,a.interaction=null,a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this;0==this.props.GlobalStore.stub_data.length?A(function(t){e.props.dispatch({type:"LOADED_DATA",data:t.data}),setTimeout(function(){e.setState({loaded:!0,coords:L.transform(e.props.coords,"EPSG:3857","EPSG:4326")}),e.initMarker()},300)},function(e){console.log(e)}):(this.setState({loaded:!0,coords:L.transform(this.props.coords,"EPSG:3857","EPSG:4326")}),this.initMarker())}},{key:"componentWillUnmount",value:function(){}},{key:"buildStyle",value:function(){var e=new $.default({color:"rgb(255,180,121)"}),t=new Q.default({color:"#cc2e38",width:2});return[new ee.default({image:new ne.default({fill:e,stroke:t,radius:10}),fill:e,stroke:t})]}},{key:"initMarker",value:function(){var e=this;this.vectorSource=new J.default({wrapX:!1});var t=new Ae.default(this.props.coords);this.feature=new Je.default({name:"crea_evento_"+S()().format("X"),geometry:t}),this.feature.setId(1),this.vectorSource.addFeature(this.feature),this.vectorLayer=new K.default({visible:!0,name:"crea_evento_"+S()().format("X"),source:this.vectorSource,style:this.buildStyle()}),this.vectorLayer.setZIndex(99999999),this.select=new Ct.default({layers:[this.vectorLayer]}),this.interaction=new Pt.default({features:this.select.getFeatures()}),this.props.map.addLayer(this.vectorLayer),this.props.map.addInteraction(this.select),this.props.map.addInteraction(this.interaction),this.setState({added:!0}),this.interaction.on("translateend",function(t){var a=L.transform(t.coordinate,"EPSG:3857","EPSG:4326");e.setState({coords:a})}),this.vectorSource=new J.default({wrapX:!1})}},{key:"componentWillMount",value:function(){}},{key:"submitted",value:function(e){var t=this;e.lat=this.state.coords[1],e.lon=this.state.coords[0],this.props.parent&&(e.idparent=this.props.parent.id),jt(e,function(e){console.log(e.data),t.setState({open_form:!1}),t.props.onCreate&&t.props.onCreate()},function(e){console.log(e)})}},{key:"confirmAddEvent",value:function(){this.deleteMarker(),this.setState({open_form:!0})}},{key:"annullate",value:function(){var e=this;this.setState({open_form:!1},function(){e.deleteMarker(),e.props.annullate()})}},{key:"deleteMarker",value:function(){this.props.map.removeInteraction(this.select),this.props.map.removeInteraction(this.interaction),this.props.map.removeLayer(this.vectorLayer),this.vectorLayer=null,this.interaction=null,this.select=null,this.vectorSource=null}},{key:"render",value:function(){var e=this;return this.state.loaded?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{position:"fixed",bottom:20,right:20,zIndex:9}},r.a.createElement(Ze.default,{size:"large",type:"primary",onClick:function(){return e.confirmAddEvent()}},"Conferma la posizione"),r.a.createElement(Ze.default,{style:{marginLeft:12},size:"large",type:"danger",onClick:function(){return e.annullate()}},"Annulla")),r.a.createElement(Ie.default,{title:"Crea evento",visible:this.state.open_form,onOk:function(){e.setState({open_form:!1})},okButtonProps:{style:{display:"none"}},onCancel:function(){e.props.annullate(),e.setState({open_form:!1})},cancelText:"Annulla"},r.a.createElement(Et,{loading:this.props.loading||!1,form_model:Lt,values:{},searchComune:function(){return e.state.comuni.map(function(e){return r.a.createElement(xt,{key:e.id,value:""+e.id},e.comune)})},searchingComune:function(){var t=Object(c.a)(l.a.mark(function t(a){var n;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=new RegExp("^"+a,"gi"),a&&""!==a?e.setState({comuni:e.props.GlobalStore.stub_data.comuni.filter(function(e){return e.comune.match(n)})}):[];case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),tipologie:this.props.GlobalStore.stub_data.tipi_evento.filter(function(e){return!e.idparent}).map(function(e){return{label:e.tipologia,value:""+e.id}}),selectTipologia:function(t,a){e.setState({id_tipologia:t})},notEmptyTipologia:function(){return e.state.id_tipologia},sottotipologie:this.props.GlobalStore.stub_data.tipi_evento.filter(function(t){return t.idparent==e.state.id_tipologia}).map(function(e){return{label:e.tipologia,value:""+e.id}}),submitted:function(t){return e.submitted(t)}}))):null}}]),t}(n.Component),Rt=Object(y.b)(function(e){return{UserStore:e.UserStore,GlobalStore:e.GlobalStore}})(Ft),Gt=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(new D).makeRequest({},{},null,"get","map/segnalazione/"+e,t,a||null,null)},Nt=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(new D).makeRequest({},t,null,"post","map/segnalazione/"+e+"/change-position",a,n||null,null)},Tt=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(new D).makeRequest({},e,null,"post","map/segnalazione",t,a||null,null)},Dt=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(new D).makeRequest({},{},null,"post","map/segnalazione/"+e+"/attach-event/"+t,a,n||null,null)},It=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(new D).makeRequest({},{},null,"get","map/organizzazione/"+e,t,a||null,null)},At=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(new D).makeRequest({},{},null,"get","map/organizzazione/all",e,t||null,null)},Mt=$e.default.Option,qt={layout:"vertical",multistep:!1,rows:[{cols:[{span:24,items:[{type:"select",label:"Tipologia",name:"tipologia_evento",validations:[{type:"required",error_message:"Campo obbligatorio"}],options_props:"tipologie",onSelectFunc:"selectTipologia"}]}]},{cols:[{span:24,items:[{type:"select",label:"Sottotipologia",name:"sottotipologia_evento",showIf:[{type:"prop_func",func:"notEmptyTipologia"}],options_props:"sottotipologie"}]}]},{cols:[{span:24,items:[{type:"autocomplete",label:"Comune",name:"idcomune",props:{},validations:[{type:"required",error_message:"Campo obbligatorio"}],withIcon:!0,dataFunc:"searchComune",onSearch:"searchingComune"}]}]},{cols:[{span:24,items:[{type:"input",label:"Indirizzo",name:"indirizzo"}]}]},{cols:[{span:24,items:[{type:"input",label:"Luogo",name:"luogo"}]}]},{cols:[{span:24,items:[{type:"select",label:"Tipo segnalatore",name:"tipo",validations:[{type:"required",error_message:"Campo obbligatorio"}],options:[{value:"1",label:"Cittadino Privato"},{value:"2",label:"Ente pubblico"},{value:"3",label:"Organizzazione di volontariato"}]}]}]},{cols:[{span:24,items:[{type:"select",label:"Ruolo segnalatore",name:"id_ruolo_segnalatore",validations:[{type:"required",error_message:"Campo obbligatorio"}],showIf:[{type:"field_validation",field:"tipo",operator:"==",value:2}],options_props:"ruolo_segnalatore"}]}]},{cols:[{span:24,items:[{type:"autocomplete",label:"Organizzazione",name:"id_organizzazione",props:{},validations:[{type:"required",error_message:"Campo obbligatorio"}],showIf:[{type:"field_validation",field:"tipo",operator:"==",value:3}],withIcon:!0,dataFunc:"searchOrganizzazione",onSearch:"searchingOrganizzazione"}]}]},{cols:[{span:24,items:[{type:"input",label:"Nome segnalatore",validations:[{type:"required",error_message:"Campo obbligatorio"}],name:"nome"}]}]},{cols:[{span:24,items:[{type:"input",label:"Cognome segnalatore",validations:[{type:"required",error_message:"Campo obbligatorio"}],name:"cognome"}]}]},{cols:[{span:24,items:[{type:"input",label:"Telefono segnalatore",validations:[{type:"required",error_message:"Campo obbligatorio"}],name:"telefono"}]}]},{cols:[{items:[{name:"submit",type:"submit",text:"Conferma",btn_type:"primary"}]}]}],onSubmit:"submitted"},Yt=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={loading:!1,comuni:[],organizzazioni:[],all_organizzazioni:[],id_tipologia:!1,coords:[]},a.vectorSource=null,a.vectorLayer=null,a.feature=null,a.select=null,a.interaction=null,a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this;0==this.state.organizzazioni.length&&At(function(t){console.log("metto org",t.data),e.setState({organizzazioni:t.data})},function(e){console.log(e)}),0==this.props.GlobalStore.stub_data.length?A(function(t){e.props.dispatch({type:"LOADED_DATA",data:t.data}),setTimeout(function(){e.setState({loaded:!0,coords:L.transform(e.props.coords,"EPSG:3857","EPSG:4326")}),e.initMarker()},300)},function(e){console.log(e)}):(this.setState({loaded:!0,coords:L.transform(this.props.coords,"EPSG:3857","EPSG:4326")}),this.initMarker())}},{key:"submitted",value:function(e){var t=this;e.lat=this.state.coords[1],e.lon=this.state.coords[0],Tt(e,function(e){t.props.onCreate&&t.props.onCreate()},function(e){console.log(e)})}},{key:"buildStyle",value:function(){var e=new $.default({color:"rgb(255,180,121)"}),t=new Q.default({color:"#cc2e38",width:2});return[new ee.default({image:new ne.default({fill:e,stroke:t,radius:10}),fill:e,stroke:t})]}},{key:"initMarker",value:function(){var e=this;this.vectorSource=new J.default({wrapX:!1});var t=new Ae.default(this.props.coords);this.feature=new Je.default({name:"crea_segnalazione_"+S()().format("X"),geometry:t}),this.feature.setId(1),this.vectorSource.addFeature(this.feature),this.vectorLayer=new K.default({visible:!0,name:"crea_segnalazione_"+S()().format("X"),source:this.vectorSource,style:this.buildStyle()}),this.vectorLayer.setZIndex(99999999),this.select=new Ct.default({layers:[this.vectorLayer]}),this.interaction=new Pt.default({features:this.select.getFeatures()}),this.props.map.addLayer(this.vectorLayer),this.props.map.addInteraction(this.select),this.props.map.addInteraction(this.interaction),this.setState({added:!0}),this.interaction.on("translateend",function(t){var a=L.transform(t.coordinate,"EPSG:3857","EPSG:4326");e.setState({coords:a})}),this.vectorSource=new J.default({wrapX:!1})}},{key:"confirmAddSegnalazione",value:function(){this.deleteMarker(),this.setState({open_form:!0})}},{key:"annullate",value:function(){var e=this;this.setState({open_form:!1},function(){e.deleteMarker(),e.props.annullate()})}},{key:"deleteMarker",value:function(){this.props.map.removeInteraction(this.select),this.props.map.removeInteraction(this.interaction),this.props.map.removeLayer(this.vectorLayer),this.vectorLayer=null,this.interaction=null,this.select=null,this.vectorSource=null}},{key:"render",value:function(){var e=this;return this.state.loaded?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{position:"fixed",bottom:20,right:20,zIndex:9}},r.a.createElement(Ze.default,{size:"large",type:"primary",onClick:function(){return e.confirmAddSegnalazione()}},"Conferma la posizione"),r.a.createElement(Ze.default,{style:{marginLeft:12},size:"large",type:"danger",onClick:function(){return e.annullate()}},"Annulla")),r.a.createElement(Ie.default,{title:"Crea segnalazione",visible:this.state.open_form,onOk:function(){e.setState({open_form:!1})},okButtonProps:{style:{display:"none"}},onCancel:function(){e.props.annullate(),e.setState({open_form:!1})},cancelText:"Annulla"},r.a.createElement(Et,{loading:this.props.loading||!1,form_model:qt,values:{},searchComune:function(){return e.state.comuni.map(function(e){return r.a.createElement(Mt,{key:e.id,value:""+e.id},e.comune)})},searchingComune:function(){var t=Object(c.a)(l.a.mark(function t(a){var n;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=new RegExp("^"+a,"gi"),a&&""!==a?e.setState({comuni:e.props.GlobalStore.stub_data.comuni.filter(function(e){return e.comune.match(n)})}):[];case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),searchOrganizzazione:function(){return e.state.all_organizzazioni.map(function(e){return r.a.createElement(Mt,{key:e.id,value:""+e.id},e.denominazione)})},searchingOrganizzazione:function(){var t=Object(c.a)(l.a.mark(function t(a){var n;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=new RegExp("^"+a,"gi"),a&&""!==a?e.setState({all_organizzazioni:e.state.organizzazioni.filter(function(e){return e.denominazione&&e.denominazione.match(n)})}):[];case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),ruolo_segnalatore:this.props.GlobalStore.stub_data.ruoli_segnalatore.map(function(e){return{label:e.descrizione,value:""+e.id}}),tipologie:this.props.GlobalStore.stub_data.tipi_evento.filter(function(e){return!e.idparent}).map(function(e){return{label:e.tipologia,value:""+e.id}}),selectTipologia:function(t,a){e.setState({id_tipologia:t})},notEmptyTipologia:function(){return e.state.id_tipologia},sottotipologie:this.props.GlobalStore.stub_data.tipi_evento.filter(function(t){return t.idparent==e.state.id_tipologia}).map(function(e){return{label:e.tipologia,value:""+e.id}}),submitted:function(t){return e.submitted(t)}}))):null}}]),t}(n.Component),Vt=Object(y.b)(function(e){return{UserStore:e.UserStore,GlobalStore:e.GlobalStore}})(Yt),Ut=function(e,t){try{var a=!1;return Array.isArray(t)?(t.map(function(t){e.permissions[t]&&(a=!0)}),a):!!e.permissions[t]}catch(n){return!1}},Wt=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={loaded:!1,showMenu:!1,mapMenuCoords:[0,0],openModalCoords:!1,searchingPath:!1,pathFrom:[],pathTo:[],create_event:!1,create_segnalazione:!1,coords:[]},a.vectorSource=new J.default({wrapX:!1}),a.vectorLayer=null,a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"centerMap",value:function(e){this.props.map.getView().setCenter(e.coordinate)}},{key:"showCoordinate",value:function(e){var t=L.transform(e.coordinate,"EPSG:3857","EPSG:4326");this.setState({openModalCoords:!0,lat:t[1],lon:t[0]})}},{key:"canCreateEvento",value:function(){return!!Ut(this.props.UserStore,"createEvento")}},{key:"canCreateSegnalazione",value:function(){return!!Ut(this.props.UserStore,"createSegnalazione")}},{key:"searchFeatures",value:function(){var e=Object(c.a)(l.a.mark(function e(t,a){var n,r,o,i,s;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Ue.a,r=new Ae.default(a.coordinate),o=new Je.default({geometry:r,name:"TempPoint"}),i=o.getGeometry().transform("EPSG:3857","EPSG:4326"),n.writeGeometryText(i),this.props.map.getView().getProjection().getUnits(),this.props.map.getView().getResolution(),20,a.pixel,e.next=11,Ke.searchOnPoint(a.coordinate,this.props.map);case 11:(s=e.sent).length>0?this.props.dispatch({type:"ADD_GRID",grid:{id:"contex_menu_search_"+S()().format("X"),layers:s}}):N.a.error("Nessun risultato");case 13:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"setFrom",value:function(e,t){this.vectorLayer||(this.vectorLayer=new K.default({name:"path_",source:this.vectorSource,style:this.buildStyle()}),this.props.map.addLayer(this.vectorLayer)),this.setState({pathFrom:L.transform(e.coordinate,"EPSG:3857","EPSG:4326"),searchingPath:!0})}},{key:"buildStyle",value:function(){var e=new $.default({color:"rgb(255,180,121)"}),t=new Q.default({color:"#cc2e38",width:2});return[new ee.default({image:new ne.default({fill:e,stroke:t,radius:5}),fill:e,stroke:t})]}},{key:"setTo",value:function(e,t){var a=this;this.setState({pathTo:L.transform(e.coordinate,"EPSG:3857","EPSG:4326"),searchingPath:!1});var n=window.base_geoserver_url+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=postgis:best_route&outputFormat=application%2Fjson";n+="&viewparams=elon:"+this.state.pathFrom[0]+";elat:"+this.state.pathFrom[1]+";slon:"+this.state.pathTo[0]+";slat:"+this.state.pathTo[1],this.props.loading&&this.props.loading(!0),fetch(n).then(function(e){return e.json()}).then(function(e){e.features.map(function(e){var t=(new V.default).readFeatureFromObject(e);return t.getGeometry().transform("EPSG:4326","EPSG:3857"),a.vectorSource.addFeature(t),a.props.loading&&a.props.loading(!1),e})}).catch(function(e){a.props.loading&&a.props.loading(!1)})}},{key:"createEvent",value:function(e,t){this.setState({create_event:!0,coords:e.coordinate})}},{key:"createSegnalazione",value:function(e,t){this.setState({create_segnalazione:!0,coords:e.coordinate})}},{key:"createdEvent",value:function(){Ce(this.props.map),this.setState({create_event:!1})}},{key:"createdSegnalazione",value:function(){Ce(this.props.map),this.setState({create_segnalazione:!1})}},{key:"openEngage",value:function(e,t){this.setState({open_engage:!0})}},{key:"componentDidMount",value:function(){var e=this,t=new qe.a({width:170,items:[]});this.props.map.addControl(t),t.on("beforeopen",function(){var a=Object(c.a)(l.a.mark(function a(n){return l.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:t.clear(),t.push({text:"Centra la mappa qui",classname:"",callback:function(t){return e.centerMap(t,n)}}),t.push({text:"Coordinate",classname:"",callback:function(t){return e.showCoordinate(t)}}),t.push({text:"Informazioni",classname:"",callback:function(t){return e.searchFeatures(t,n)}}),e.state.create_event||e.state.create_segnalazione||(e.canCreateEvento()&&t.push({text:"Crea evento",classname:"",callback:function(t){return e.createEvent(t,n)}}),e.canCreateSegnalazione()&&t.push({text:"Crea segnalazione",classname:"",callback:function(t){return e.createSegnalazione(t,n)}})),t.push({text:"Calcola percorso da qui",classname:"",callback:function(t){return e.setFrom(t,n)}}),e.state.searchingPath&&t.push({text:"Caclola percorso fino a qui",classname:"",callback:function(t){return e.setTo(t,n)}});case 7:case"end":return a.stop()}},a)}));return function(e){return a.apply(this,arguments)}}())}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ie.default,{title:"Coordinate",visible:this.state.openModalCoords,onOk:function(){e.setState({openModalCoords:!1})},onCancel:function(){return e.setState({openModalCoords:!1})}},r.a.createElement("h4",null,this.state.lat," - ",this.state.lon)),this.state.create_event?r.a.createElement(Rt,{annullate:function(){return e.setState({create_event:!1})},onCreate:function(){return e.createdEvent()},coords:this.state.coords,map:this.props.map}):null,this.state.create_segnalazione?r.a.createElement(Vt,{annullate:function(){return e.setState({create_segnalazione:!1})},onCreate:function(){return e.createdSegnalazione()},coords:this.state.coords,map:this.props.map}):null)}}]),t}(n.Component),Bt=Object(y.b)(function(e){return{SearchStore:e.SearchStore,UserStore:e.UserStore}})(Wt),Xt=(a(300),a(134)),Ht=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(new D).makeRequest({},e,null,"post","map/auth/login",t,a||null,null)},Kt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(new D).makeRequest({},{},null,"get","map/auth/profile",e,t||null,null)},Jt={layout:"vertical",multistep:!1,rows:[{cols:[{span:24,md:24,items:[{type:"input",label:"Username",type_string:"text",name:"username",props:{size:"large",prefix:r.a.createElement(rt.default,{type:"user",style:{color:"rgba(0,0,0,.25)"}})},validations:[{type:"required",error_message:"Campo obbligatorio"}]},{type:"input",label:"Password",type_string:"password",name:"password",props:{size:"large",prefix:r.a.createElement(rt.default,{type:"lock",style:{color:"rgba(0,0,0,.25)"}})},validations:[{type:"required",error_message:"Campo obbligatorio"}]},{name:"submit",type:"submit",text:"Accedi",btn_type:"primary",props:{block:!0,size:"large"}}]}]}],onSubmit:"submitted"},Zt=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!1,open_modal:!1},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillMount",value:function(){}},{key:"logout",value:function(){localStorage.removeItem("token"),this.props.dispatch({type:"SET_USER_STORE",obj:{loggedIn:!1}})}},{key:"submitted",value:function(e){var t=this;Ht(e,function(e){e.data.token?(localStorage.setItem("token",e.data.token),t.setState({open_modal:!1},function(){t.props.dispatch({type:"SET_USER_STORE",obj:{user:e.data.user,permissions:e.data.permissions,jwt:e.data.token,loggedIn:!0}})})):N.a.error("Qualcosa \xe8 andato storto")},function(e){console.log(e)})}},{key:"openModal",value:function(){this.setState({open_modal:!0})}},{key:"render",value:function(){var e=this;return this.props.UserStore.loggedIn?r.a.createElement(Xt.default,{title:"Esci",placement:"left"},r.a.createElement(G.a,{type:"primary",onClick:function(){return e.logout()},style:{float:"right",marginTop:16,marginRight:16}},r.a.createElement(rt.default,{type:"unlock",style:{color:"#fff"}}))):r.a.createElement(r.a.Fragment,null,r.a.createElement(Xt.default,{title:"Accedi",placement:"left"},r.a.createElement(G.a,{type:"primary",icon:"lock",onClick:function(){return e.openModal()},ghost:!0,style:{float:"right",marginTop:16,marginRight:16}})),r.a.createElement(Ie.default,{title:"Accedi",visible:this.state.open_modal,onOk:function(){var t=e.formSelRef.props.form.getFieldsValue().username,a=e.formSelRef.props.form.getFieldsValue().password;t&&""!==t&&a&&""!==a?e.submitted({username:e.formSelRef.props.form.getFieldsValue().username,password:e.formSelRef.props.form.getFieldsValue().password}):N.a.error("Compila i campi")},onCancel:function(){return e.setState({open_modal:!1})}},r.a.createElement("div",null,r.a.createElement(Et,{loading:this.props.loading||!1,form_model:Jt,values:{},submitted:function(t){return e.submitted(t)}}))))}}]),t}(n.Component),$t=Object(y.b)(function(e){return{UserStore:e.UserStore}})(Zt),Qt=a(350),ea=a.n(Qt),ta=a(174),aa=a.n(ta),na=a(637),ra=a(61),oa=a(62),ia=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={btnPointPos:50,btnLinePos:50,btnPolyPos:50,btnCirclePos:50,btnRectPos:50,btnLabelPos:50,btnSelectPos:50,btnCopyPos:50,btnDelPos:50,btnsOpacity:0,btnsVisible:!1,drawing:!1,displayColorPicker:!1,colorPickerLeft:"50"},a.showButtons=function(){a.state.btnsVisible?(console.log("hide"),a.setState({btnPointPos:10,btnLinePos:10,btnPolyPos:10,btnCirclePos:10,btnRectPos:10,btnLabelPos:10,btnSelectPos:10,btnCopyPos:10,btnDelPos:10,btnsOpacity:0,btnsVisible:!1}),null!=a.draw&&a.props.map.removeInteraction(a.draw),a.state.selectionDone&&(a.props.map.removeInteraction(a.selectClick),a.clearSearch())):(console.log("show"),a.setState({btnPointPos:60,btnLinePos:110,btnPolyPos:160,btnCirclePos:210,btnRectPos:260,btnLabelPos:310,btnSelectPos:360,btnCopyPos:410,btnDelPos:460,btnsOpacity:1,btnsVisible:!0}))},a.digitButtonClickEvent=function(e){a.setState({displayColorPicker:!1}),e.pressed||("drawPoint"===e.name&&(a.setState({colorPickerLeft:100}),a.setState({displayColorPicker:!0})),"drawLine"===e.name&&(a.setState({colorPickerLeft:150}),a.setState({displayColorPicker:!0})),"drawPolygon"===e.name&&(a.setState({colorPickerLeft:200}),a.setState({displayColorPicker:!0})),"drawCircle"===e.name&&(a.setState({colorPickerLeft:250}),a.setState({displayColorPicker:!0})),"drawRectangle"===e.name&&(a.setState({colorPickerLeft:300}),a.setState({displayColorPicker:!0})))},a.handleCloseColorPicker=function(){},a.handleChangeColorPicker=function(e){a.selectedColor=e.hex,console.log(a.selectedColor)},a.formatNum=function(e,t){return e.toFixed(t).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1.")},a.getText=function(e){var t="",n=e.clone().getGeometry(),r=e.clone().getGeometry().transform("EPSG:3857","EPSG:4326"),o=n.transform("EPSG:3857","EPSG:32632");if("Point"===o.getType().toString()){var i=r.getCoordinates(),s=i[0].toFixed(6),l=i[1].toFixed(6);t="".concat(l,"N ").concat(s,"E")}else if("LineString"===o.getType().toString()){var c=o.getLength();t=a.formatNum(c,0)+" m."}else if("Circle"===o.getType().toString()){var u=o.getRadius(),p=Math.pow(u,2)*Math.PI;t=a.formatNum(p,2)+" mq"}else{var d=o.getArea();t=a.formatNum(d,2)+" mq"}return t},a.drawEnd=function(e){a.setState({displayColorPicker:!1});var n=(a.selectedColor,t.hexToRgb(a.selectedColor));console.log(n);var r="rgba("+n.r+","+n.g+","+n.b+",0.2)",o=new $.default({color:r}),i=new Q.default({color:a.selectedColor,width:2}),s=new ee.default({image:new ne.default({fill:o,stroke:i,radius:5}),fill:o,stroke:i,text:new te.default({font:"bold 12px Arial",offsetY:15,text:a.getText(e.feature),stroke:new Q.default({color:"#ffffff",width:4})})});e.feature.setStyle(s);var l={};l.color=a.selectedColor,e.feature.setProperties(l)},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){Be.default.defs("EPSG:32632","+proj=utm +zone=32 +datum=WGS84 +units=m +no_defs"),Object(We.a)(Be.default),this.selectedColor="#ff0000"}},{key:"onMenuClick",value:function(e){this.state.selected===e.key?this.setState({selected:[]}):this.setState({selected:[e.key]})}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.props.GlobalStore.loaded_layers?r.a.createElement(ea.a,{icon:"pen",allowDeselect:!0,selectedName:"point",className:"sider_toggle",onChange:this.digitButtonClickEvent},r.a.createElement(aa.a,{name:"drawPoint",map:this.props.map,icon:"crosshairs",tooltip:"Diesgna punti",onDrawEnd:this.drawEnd,drawType:"Point",style:{}}),r.a.createElement(aa.a,{name:"drawLine",map:this.props.map,drawType:"LineString",onDrawEnd:this.drawEnd,tooltip:"disegna linee",icon:"pencil",style:{}}),r.a.createElement(aa.a,{name:"drawPolygon",map:this.props.map,drawType:"Polygon",onDrawEnd:this.drawEnd,tooltip:"disegna poligoni",style:{}},r.a.createElement(ra.a,{icon:oa.b,style:{fontSize:23}})),r.a.createElement(aa.a,{name:"drawCircle",map:this.props.map,icon:"circle-o",className:"btn-success",tooltip:"disegna cerchi",drawType:"Circle",onDrawEnd:this.drawEnd,style:{}}),r.a.createElement(aa.a,{name:"drawRectangle",map:this.props.map,drawType:"Rectangle",onDrawEnd:this.drawEnd,tooltip:"disegna rettangoli",style:{}}," ",r.a.createElement(ra.a,{icon:oa.m,style:{fontSize:23}})),r.a.createElement(aa.a,{name:"drawText",map:this.props.map,drawType:"Text",tooltip:"inserisci testo",icon:"font",style:{}}),r.a.createElement(aa.a,{name:"selectAndModify",tooltip:"Seleziona",map:this.props.map,editType:"Edit",icon:"mouse-pointer",style:{}}),r.a.createElement(aa.a,{name:"copyFeature",tooltip:"copia",map:this.props.map,editType:"Copy",icon:"copy",style:{}}),r.a.createElement(aa.a,{name:"deleteFeature",tooltip:"elimina",map:this.props.map,editType:"Delete",icon:"eraser",style:{}})):null,this.state.displayColorPicker?r.a.createElement("div",{style:{position:"absolute",zIndex:2,top:"65px",left:"90px",background:"white",padding:"4px",borderRadius:"5px"}},r.a.createElement("div",{style:{position:"absolute",top:"0px",right:"0px",bottom:"0px",left:"0px"},onClick:this.handleCloseColorPicker}),r.a.createElement(na.CirclePicker,{onChangeComplete:this.handleChangeColorPicker})):null)}}],[{key:"hexToRgb",value:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}}]),t}(n.Component),sa=Object(y.b)(function(e){return{GlobalStore:e.GlobalStore}})(ia),la=a(53),ca=(a(256),a(104)),ua=a(192),pa=a.n(ua),da=a(466),ha=a.n(da),ma=a(167),fa=a.n(ma),ga=a(135),va=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).invokeParentMethod=a.invokeParentMethod.bind(Object(ga.a)(a)),a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"invokeParentMethod",value:function(){this.props.context.componentParent.methodFromParent("Row: ".concat(this.props.node.rowIndex,", Col: ").concat(this.props.colDef.headerName))}},{key:"open",value:function(){this.props.context.componentParent.openPanel({id:this.props.context.layer.layer_identifier+"_"+this.props.data.id,layer_name:this.props.context.layer.layer_identifier,layer:this.props.context.layer.layer,row_data:this.props.data,feature:this.props.context.layer.features[this.props.node.rowIndex]})}},{key:"center",value:function(){this.props.context.layer.features[this.props.node.rowIndex]&&this.props.context.layer.features[this.props.node.rowIndex].values_.bbox&&this.props.context.componentParent.props.map.getView().fit(this.props.context.layer.features[this.props.node.rowIndex].values_.bbox.slice(0),{maxZoom:15})}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ze.default,{icon:"eye",size:"small",style:{},onClick:function(){return e.open()}}),r.a.createElement(Ze.default,{icon:"pushpin",size:"small",style:{marginLeft:6},onClick:function(){return e.center()}}))}}]),t}(n.Component),ya=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(new D).makeRequest(e,{},null,"get","map/ingaggi/search",t,a||null,null)},ba=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(new D).makeRequest(e,{},null,"get","map/ingaggi/engage",t,a||null,null)},_a=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={loading_distance:!1,loaded_distance:!1,engaging:!1},a.vectorSource=new J.default({wrapX:!1}),a.vectorLayer=null,a.invokeParentMethod=a.invokeParentMethod.bind(Object(ga.a)(a)),a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"invokeParentMethod",value:function(){this.props.context.componentParent.methodFromParent("Row: ".concat(this.props.node.rowIndex,", Col: ").concat(this.props.colDef.headerName))}},{key:"getFeature",value:function(){var e=this,t=null;return this.props.context.layer.features.map(function(a){a.get("ref_id")==e.props.data.ref_id&&(t=a)}),t}},{key:"open",value:function(){this.props.context.componentParent.openPanel({id:this.props.context.layer.layer_identifier+"_"+this.props.data.ref_id,layer_name:"Risorsa",layer:this.props.context.layer.layer,row_data:this.props.data,feature:this.getFeature()})}},{key:"center",value:function(){this.props.context.layer.features[this.props.node.rowIndex].getProperties();var e=L.transform([parseFloat(this.props.data.lon),parseFloat(this.props.data.lat)],"EPSG:4326","EPSG:3857");this.props.context.componentParent.props.map.getView().setCenter(e)}},{key:"buildStyle",value:function(){var e=new $.default({color:"rgb(255,180,121)"}),t=new Q.default({color:"#cc2e38",width:2});return[new ee.default({image:new ne.default({fill:e,stroke:t,radius:5}),fill:e,stroke:t})]}},{key:"engage",value:function(){var e=this;this.state.engaging||this.setState({engaging:!0},function(){ba({event_id:e.props.context.layer.event.id,ref_type:e.props.data.tipologia_risorsa,ref_id:e.props.data.ref_id},function(t){e.setState({engaging:!1}),""!=e.getFeature().get("ref_tipo_descrizione")&&(e.getFeature().set("ref_engaged",!0),e.props.context.refresh&&e.props.context.refresh()),e.props.context.layer.cb&&e.props.context.layer.cb()},function(t){e.setState({engaging:!1})})})}},{key:"getDistance",value:function(){var e=this;if(!this.state.loaded_distance||!this.state.loading_distance){this.setState({loading_distance:!0}),this.vectorLayer||(this.vectorLayer=new K.default({name:"path_",source:this.vectorSource,style:this.buildStyle()}),this.props.context.componentParent.props.map.addLayer(this.vectorLayer));var t=window.base_geoserver_url+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=postgis:best_route&outputFormat=application%2Fjson";t+="&viewparams=elon:"+this.props.context.layer.event.lon+";elat:"+this.props.context.layer.event.lat+";slon:"+this.props.data.lon+";slat:"+this.props.data.lat,fetch(t).then(function(e){return e.json()}).then(function(t){t.features.map(function(t){var a=(new V.default).readFeatureFromObject(t);a.getGeometry().transform("EPSG:4326","EPSG:3857"),e.vectorSource.addFeature(a)}),e.setState({loaded_distance:!0,loading_distance:!1})}).catch(function(t){e.setState({loading_distance:!1})})}}},{key:"isEngageble",value:function(){return!this.getFeature().get("ref_engaged")}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ze.default,{icon:"eye",size:"small",style:{},onClick:function(){return e.open()}}),r.a.createElement(Ze.default,{icon:"pushpin",size:"small",style:{marginLeft:6},onClick:function(){return e.center()}}),this.isEngageble()?r.a.createElement(Ze.default,{loading:this.state.engaging,size:"small",style:{marginLeft:6},onClick:function(){return e.engage()}},r.a.createElement(ra.a,{icon:oa.a,style:{fontSize:10}})):null,this.state.loaded_distance?null:r.a.createElement(Ze.default,{loading:this.state.loading_distance,size:"small",style:{marginLeft:6},onClick:function(){return e.getDistance()}},r.a.createElement(ra.a,{icon:oa.j,style:{fontSize:10}})))}}]),t}(n.Component),wa=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={open_foto:!1},a.invokeParentMethod=a.invokeParentMethod.bind(Object(ga.a)(a)),a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"invokeParentMethod",value:function(){this.props.context.componentParent.methodFromParent("Row: ".concat(this.props.node.rowIndex,", Col: ").concat(this.props.colDef.headerName))}},{key:"getPhotoUrl",value:function(){return window.base_api_url+"v1/media/view-media/"+this.props.data.foto_id}},{key:"hasPhoto",value:function(){return!!this.props.data.foto_url}},{key:"openPhoto",value:function(){this.setState({open_foto:!0})}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,this.hasPhoto()?r.a.createElement(r.a.Fragment,null,r.a.createElement(Ze.default,{size:"small",style:{marginLeft:6},onClick:function(){return e.openPhoto()}},r.a.createElement(ra.a,{icon:oa.e,style:{fontSize:10}})),r.a.createElement(Ie.default,{title:"Foto",visible:this.state.open_foto,onOk:function(){e.setState({open_foto:!1})},okButtonProps:{style:{display:"none"}},onCancel:function(){e.setState({open_foto:!1})},cancelText:"Chiudi"},r.a.createElement("img",{style:{width:"100%",height:"auto"},src:this.getPhotoUrl(),alt:""}))):null)}}]),t}(n.Component),Sa=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={loading_distance:!1,loaded_distance:!1,engaging:!1},a.invokeParentMethod=a.invokeParentMethod.bind(Object(ga.a)(a)),a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){console.log("specializzazioni",this.props)}},{key:"invokeParentMethod",value:function(){this.props.context.componentParent.methodFromParent("Row: ".concat(this.props.node.rowIndex,", Col: ").concat(this.props.colDef.headerName))}},{key:"getSpec",value:function(){var e=[];return this.props.data.sezioneSpecialistica.map(function(t){return e.push(t.descrizione)}),e.join(", ")}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.getSpec())}}]),t}(n.Component),ka=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={loading_distance:!1,loaded_distance:!1,engaging:!1},a.invokeParentMethod=a.invokeParentMethod.bind(Object(ga.a)(a)),a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){}},{key:"invokeParentMethod",value:function(){this.props.context.componentParent.methodFromParent("Row: ".concat(this.props.node.rowIndex,", Col: ").concat(this.props.colDef.headerName))}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.props.data.contattiAttivazioni.map(function(e){var t=e.note?e.note+": ":"";return t+=e.contatto.contatto,r.a.createElement("p",null,t)}))}}]),t}(n.Component),Ea=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={},a.gridApi=null,a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"returnColumnDef",value:function(e){switch(e.layer_identifier){case"Eventi":return[{headerName:"",field:"id",width:100,cellRenderer:"GridCellRenderer"},{headerName:"Num. protocollo",field:"num_protocollo",width:100},{headerName:"Protocollo evento genitore",field:"protocollo_evento_genitore",width:150},{headerName:"Stato",field:"stato",width:70},{headerName:"Tipologia",field:"tipologia",width:100},{headerName:"Sottotipologia",field:"sottotipologia",width:100},{headerName:"Indirizzo",field:"indirizzo",width:100},{headerName:"Tipo",field:"tipo",width:70},{headerName:"Comune",field:"comune",width:100}];case"Eventi chiusi":return[{headerName:"",field:"id",width:100,cellRenderer:"GridCellRenderer"},{headerName:"",field:"id",width:100,cellRendererSelector:function(e){console.log("parametri riga",e)}},{headerName:"Num. protocollo",field:"num_protocollo",width:100},{headerName:"Protocollo evento genitore",field:"protocollo_evento_genitore",width:150},{headerName:"Stato",field:"stato",width:70},{headerName:"Tipologia",field:"tipologia",width:100},{headerName:"Sottotipologia",field:"sottotipologia",width:100},{headerName:"Indirizzo",field:"indirizzo",width:100},{headerName:"Tipo",field:"tipo",width:70},{headerName:"Comune",field:"comune",width:100}];case"Segnalazioni":return[{headerName:"",field:"id",width:100,cellRenderer:"GridCellRenderer"},{headerName:"Foto",field:"foto_url",cellRenderer:"GridCellFotoRenderer"},{headerName:"Num. protocollo",field:"num_protocollo",width:100},{headerName:"Stato",field:"stato",width:70},{headerName:"Fonte",field:"fonte",width:70},{headerName:"Tipologia",field:"tipologia",width:100},{headerName:"Indirizzo",field:"indirizzo",width:100},{headerName:"Comune",field:"comune",width:100}];case"Segnalazioni chiuse":return[{headerName:"",field:"id",width:100,cellRenderer:"GridCellRenderer"},{headerName:"Foto",field:"foto_url",cellRenderer:"GridCellFotoRenderer"},{headerName:"Num. protocollo",field:"num_protocollo",width:100},{headerName:"Stato",field:"stato",width:70},{headerName:"Fonte",field:"fonte",width:70},{headerName:"Tipologia",field:"tipologia",width:100},{headerName:"Indirizzo",field:"indirizzo",width:100},{headerName:"Comune",field:"comune",width:100},{headerName:"Orientamento",field:"foto_orientation",width:50,cellRendererSelector:function(e){return e.foto_orientation?e.foto_orientation+"\xb0":""}}];case"Organizzazioni":return[{headerName:"",field:"id",width:100,cellRenderer:"GridCellRenderer"},{headerName:"Denominazione",field:"denominazione",width:100},{headerName:"Tipologia",field:"tipologia",width:70},{headerName:"Indirizzo",field:"indirizzo",width:70},{headerName:"Comune",field:"comune",width:100},{headerName:"Cod.fiscale",field:"codicefiscale",width:100},{headerName:"P.Iva",field:"partita_iva",width:100},{headerName:"Responsabile",field:"nome_responsabile",width:50},{headerName:"Cf. responsabile",field:"cf_rappresentante_legale",width:100},{headerName:"Tel. responsabile",field:"tel_responsabile",width:100},{headerName:"Nome referente",field:"nome_referente",width:100},{headerName:"Cf. referente",field:"cf_referente",width:100},{headerName:"Tel referente",field:"tel_referente",width:100},{headerName:"Fax referente",field:"fax_referente",width:100},{headerName:"Email referente",field:"email_referente",width:100}];case"Risorse ingaggiabili":return[{headerName:"",field:"id",width:160,autoHeight:!0,cellRenderer:"GridCellEngageRenderer"},{headerName:"Km.",field:"dist_km",comparator:function(e,t,a,n,r){return parseFloat(e)-parseFloat(t)},autoHeight:!0,sort:"asc",width:50},{headerName:"#Ter",field:"codice_associazione",autoHeight:!0,width:80},{headerName:"Denominazione",field:"denominazione_organizzazione",autoHeight:!0,width:160},{headerName:"Telefono",field:"contatto",cellRenderer:"GridCellContattiEngageRenderer",cellStyle:{"white-space":"normal"},autoHeight:!0,width:285},{headerName:"Orari",field:"disponibilita_oraria_sede",autoHeight:!0,width:80},{headerName:"Tipo risorsa",autoHeight:!0,field:"ref_tipo_descrizione",width:160},{headerName:"Identificatore risorsa",autoHeight:!0,field:"ref_identifier",width:160},{headerName:"Specializzazioni",field:"specializzazioni",autoHeight:!0,cellRenderer:"GridCellSpecializzazioniEngageRenderer",cellStyle:{"white-space":"normal"},width:160}];default:var t=[];t.push({headerName:"",index:0,width:100,cellRenderer:"GridCellRenderer"});var a=e.features[0].getProperties();return Object.keys(a).map(function(e){return"geometry"!==e&&t.push({headerName:e,field:e}),e}),t}}},{key:"openPanel",value:function(e){this.props.dispatch({type:"ADD_PANEL",panel:e})}},{key:"refreshData",value:function(){console.log("ricarico"),this.gridApi.refreshCells({force:!0})}},{key:"render",value:function(){var e=this;return r.a.createElement(fa.a,{defaultColDef:{enableRowGroup:!0,enablePivot:!0,enableValue:!0,sortable:!0,filter:!0,resizable:!0,width:150,minwidth:100,autoHeight:!0,suppressSizeToFit:!1},context:{componentParent:this,layer:this.props.layer,refresh:function(){return e.refreshData()}},frameworkComponents:{GridCellRenderer:va,GridCellEngageRenderer:_a,GridCellFotoRenderer:wa,GridCellSpecializzazioniEngageRenderer:Sa,GridCellContattiEngageRenderer:ka},keyFunction:this.props.layer.feature_key?function(t){return t[e.props.layer.feature_key]}:function(e){return e.ol_uid},columnDefs:this.returnColumnDef(this.props.layer),map:this.props.map,attributeBlacklist:[],features:this.props.layer.features,selectable:this.props.layer.selectable||!1,onGridReady:function(t){e.gridApi=t.api},onRowClick:function(e,t){}})}}]),t}(n.Component),za=Object(y.b)(function(e){return{SearchStore:e.SearchStore}})(Ea),Oa=ca.a.TabPane,ja=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={grids:[]},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"downloadShape",value:function(e){if("wms"==e.type||"wfs"==e.type){var t=e.query;return t=t.replace("application%2Fjson","shape-zip")}}},{key:"downloadCsv",value:function(e){if("wms"==e.type||"wfs"==e.type){var t=e.query;return t=t.replace("application%2Fjson","csv")}}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,this.props.SearchStore.grids.filter(function(e){return!e.position}).map(function(t){var a,n;return r.a.createElement(pa.a,{key:"grid_"+t.id,style:{position:"absolute",backgroundColor:"#fff"},x:100,y:100,width:500,title:"Risultato della ricerca",draggable:!0,tools:[r.a.createElement(Ze.default,(a={key:"to_left",name:"borderLeft",size:"small",ghost:!0,icon:"border-left"},Object(la.a)(a,"ghost",!0),Object(la.a)(a,"style",{marginLeft:10}),Object(la.a)(a,"type","primary"),Object(la.a)(a,"onClick",function(){e.props.dispatch({type:"GRID_TO_LEFT",id:t.id})}),a)),r.a.createElement(Ze.default,(n={key:"to_right",name:"borderRight",size:"small",ghost:!0,icon:"border-right"},Object(la.a)(n,"ghost",!0),Object(la.a)(n,"style",{marginLeft:10}),Object(la.a)(n,"type","primary"),Object(la.a)(n,"onClick",function(){e.props.dispatch({type:"GRID_TO_RIGHT",id:t.id})}),n)),r.a.createElement(G.a,{key:"key_btn",name:"clearSearch",size:"small",ghost:!0,icon:"close",style:{marginLeft:10},type:"danger",onClick:function(){t.onRemove&&t.onRemove(),e.props.dispatch({type:"REMOVE_GRID",id:t.id})}})],resizeOpts:{top:!1,right:!0,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1}},r.a.createElement(ca.a,{defaultActiveKey:"0"},t.layers.map(function(t,a,n){return r.a.createElement(Oa,{tab:t.layer_identifier,key:""+a},r.a.createElement(za,{map:e.props.map,layer:t}),r.a.createElement("div",{style:{marginTop:7}},t.query&&""!=t.query?r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{className:"ant-btn ant-btn-link ant-btn-sm",href:""+e.downloadShape(t)},r.a.createElement(ra.a,{icon:oa.c,style:{fontSize:10,marginRight:6}})," Shape"),r.a.createElement("a",{className:"ant-btn ant-btn-primary ant-btn-sm",style:{marginLeft:5},href:""+e.downloadCsv(t)},r.a.createElement(ra.a,{icon:oa.d,style:{fontSize:10,marginRight:6}})," CSV")):null))})))}))}}]),t}(n.Component),Ca=Object(y.b)(function(e){return{SearchStore:e.SearchStore}})(ja),Pa=(a(348),a(211)),xa=a(194),La=$e.default.Option,Fa={layout:"vertical",multistep:!1,rows:[{cols:[{span:12,items:[{type:"select",label:"Categoria",name:"id_categoria",mode:"multiple",options_props:"categorie",onChange:"selectCategoria"}]},{span:12,items:[{type:"select",label:"Tipologia",name:"id_tipologia",mode:"multiple",options_props:"tipologie",onChange:"selectTipologia"}]}]},{cols:[{span:12,items:[{type:"select",label:"Automezzo",name:"id_utl_automezzo_tipo",mode:"multiple",options_props:"automezzi",onSelectFunc:"selectTipoAutomezzo"}]},{span:12,items:[{type:"select",label:"Attrezzatura",name:"id_utl_attrezzatura_tipo",mode:"multiple",options_props:"attrezzature",onSelectFunc:"selectTipoAttrezzatura"}]}]},{cols:[{span:12,items:[{type:"select",label:"Provincia",name:"id_provincia",options_props:"province",onSelectFunc:"selectProvincia"}]},{span:12,items:[{type:"autocomplete",label:"Comune",name:"id_comune",dataFunc:"searchComune",onSearch:"searchingComune",onSelectFunc:"selectComune"}]}]},{cols:[{span:24,items:[{type:"autocomplete",label:"Organizzazione",name:"denominazione_organizzazione",props:{},dataFunc:"searchOrganizzazione",onSearch:"searchingOrganizzazione"}]},{span:24,items:[{type:"select",label:"Specializzazioni",name:"specializzazioni",mode:"multiple",options_props:"specializzazioni"}]}]},{cols:[{span:12,items:[{type:"select",label:"Ordina per",name:"sort",options:[{label:"Tipo attrezzatura",value:"tipo_attrezzatura_descrizione"},{label:"Tipologia elemento",value:"ref_tipo_descrizione"},{label:"Organizzazione",value:"denominazione_organizzazione"},{label:"Indirizzo",value:"indirizzo_sede"}]}]},{span:12,items:[{type:"select",label:"Direzione",name:"sort_order",options:[{label:"Ascendente",value:"asc"},{label:"Discendente",value:"desc"}]}]}]},{cols:[{span:24,items:[{type:"slider",label:"Distanza massima (Km)",name:"distance",marks:{100:"100km",200:"200km",300:"300km",400:"400km",500:"500km"},step:10,max:600,min:10,vertical:!1,dots:!1}]}]},{cols:[{items:[{name:"submit",type:"submit",text:"Conferma",btn_type:"primary"}]}]}],onSubmit:"submitted"},Ra=function(e){function t(e){var a,n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).state=(a={evento:null,lat:null,lon:null,loading:!1,comuni:[],categorie:null,tipologie:null,tipo_automezzo:null,tipo_attrezzatura:null,province:[]},Object(la.a)(a,"comuni",[]),Object(la.a)(a,"organizzazioni",[]),Object(la.a)(a,"all_organizzazioni",[]),a),n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this;if(this.setState({lat:this.props.lat,lon:this.props.lon,evento:this.props.evento}),0==this.state.organizzazioni.length&&At(function(t){e.setState({organizzazioni:t.data})},function(e){}),0==this.props.GlobalStore.stub_data.length)A(function(t){e.props.dispatch({type:"LOADED_DATA",data:t.data}),setTimeout(function(){var t=e.getCategory(e.props.tipologia);e.setState({loaded:!0,categorie:t?[t.id]:[]})},300)},function(e){});else{var t=this.getCategory(this.props.tipologia);this.setState({loaded:!0,categorie:t?[t.id]:[]})}}},{key:"getCategory",value:function(e){return this.props.GlobalStore.stub_data.categorie.find(function(t){return t.id_tipo_evento=e})}},{key:"componentWillMount",value:function(){}},{key:"submitted",value:function(e){var t=this;this.state.loading||this.setState({loading:!0},function(){e.lat=t.state.lat,e.lon=t.state.lon,ya(e,function(e){t.setState({loading:!1}),t.props.onDone&&t.props.onDone(e.data)},function(e){t.setState({loading:!1})})})}},{key:"getExcludedCategories",value:function(){var e=this;if(!this.state.tipologie||0==this.state.tipologie.length)return[];var t=[];return this.props.GlobalStore.stub_data.aggregatori.map(function(a){-1!=e.state.tipologie.indexOf(""+a.id)&&t.push(a.id_categoria)}),t}},{key:"getAvaibleAutomezzi",value:function(){var e=this,t=this.props.GlobalStore.stub_data.tipo_automezzi.map(function(e){return{label:e.descrizione,value:e.id,aggregatori:e.aggregatori}});return this.state.categorie&&0!==this.state.categorie.length||this.state.tipologie&&0!==this.state.tipologie.length?(this.state.categorie&&this.state.categorie.length>0&&(t=t.filter(function(t){var a=!1;return t.aggregatori.map(function(t){-1!=e.state.categorie.indexOf(t.id_categoria)&&(a=!0)}),a})),this.state.tipologie&&this.state.tipologie.length>0&&(t=t.filter(function(t){var a=!1;return t.aggregatori.map(function(t){-1!=e.state.tipologie.indexOf(t.id)&&(a=!0)}),a})),t):t}},{key:"getAvaibleAttrezzature",value:function(){var e=this,t=this.props.GlobalStore.stub_data.tipo_attrezzature.map(function(e){return{label:e.descrizione,value:e.id,aggregatori:e.aggregatori}});return this.state.categorie&&0!==this.state.categorie.length||this.state.tipologie&&0!==this.state.tipologie.length?(this.state.categorie&&this.state.categorie.length>0&&(t=t.filter(function(t){var a=!1;return t.aggregatori.map(function(t){-1!=e.state.categorie.indexOf(t.id_categoria)&&(a=!0)}),a})),this.state.tipologie&&this.state.tipologie.length>0&&(t=t.filter(function(t){var a=!1;return t.aggregatori.map(function(t){-1!=e.state.tipologie.indexOf(t.id)&&(a=!0)}),a})),t):t}},{key:"getAggregatori",value:function(){var e=this;if(this.state.categorie&&this.state.categorie.length>0){var t=[];return this.props.GlobalStore.stub_data.aggregatori.map(function(a){-1!=e.state.categorie.indexOf(parseInt(a.id_categoria))&&t.push({label:a.descrizione,value:a.id})}),t}return this.props.GlobalStore.stub_data.aggregatori.map(function(e){return{label:e.descrizione,value:e.id}})}},{key:"render",value:function(){var e=this;return this.state.loaded?r.a.createElement(Et,{loading:this.state.loading||!1,form_model:Fa,values:{distance:50,id_categoria:this.state.categorie,id_tipologia:[],id_utl_automezzo_tipo:[],id_utl_attrezzatura_tipo:[],specializzazioni:[]},searchComune:function(){return e.state.comuni.map(function(e){return r.a.createElement(La,{key:e.id,value:""+e.id},e.comune)})},searchingComune:function(){var t=Object(c.a)(l.a.mark(function t(a){var n;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=new RegExp("^"+a,"gi"),a&&""!==a?e.setState({comuni:e.props.GlobalStore.stub_data.comuni.filter(function(e){return e.comune.match(n)})}):[];case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),province:this.props.GlobalStore.stub_data.province.map(function(e){return{label:e.provincia,value:e.id}}),categorie:this.props.GlobalStore.stub_data.categorie.map(function(e){return{label:e.descrizione,value:e.id}}),selectCategoria:function(t){return e.setState({categorie:t})},tipologie:this.getAggregatori(),selectTipologia:function(t){return e.setState({tipologie:t})},automezzi:this.getAvaibleAutomezzi(),attrezzature:this.getAvaibleAttrezzature(),selectTipoAutomezzo:function(e,t){return null},selectTipoAttrezzatura:function(e,t){return null},searchOrganizzazione:function(){return e.state.all_organizzazioni.map(function(e){return r.a.createElement(La,{key:e.id,value:""+e.denominazione},e.denominazione)})},searchingOrganizzazione:function(){var t=Object(c.a)(l.a.mark(function t(a){var n;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=new RegExp("^"+a,"gi"),a&&""!==a?e.setState({all_organizzazioni:e.state.organizzazioni.filter(function(e){return e.denominazione.match(n)})}):[];case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),specializzazioni:this.props.GlobalStore.stub_data.specializzazioni.map(function(e){return{label:e.descrizione,value:e.id}}),submitted:function(t){return e.submitted(t)}}):null}}]),t}(n.Component),Ga=Object(y.b)(function(e){return{UserStore:e.UserStore,GlobalStore:e.GlobalStore}})(Ra),Na=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={event:[],loaded:!1,searched:!1,activables:[]},a.vectorSource=new J.default({wrapX:!1}),a.vectorLayer=null,a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){}},{key:"removeLayers",value:function(){this.props.map.removeLayer(this.vectorLayer)}},{key:"getColumns",value:function(){return[{headerName:"Stato",field:"stato"},{headerName:"Risorsa",field:"risorsa"},{headerName:"Organizzazione",field:"organizzazione"},{headerName:"Sede",field:"indirizzo"}]}},{key:"getData",value:function(){var e=[];return this.props.ingaggi.map(function(t){var a={stato:"",data:"",risorsa:"",organizzazione:"",indirizzo:"",lat:"",lon:"",geom:""};switch(t.stato){case 0:a.stato="In attesa di conferma";break;case 1:a.stato="Confermato";break;case 2:a.stato="Rifiutato";break;case 3:a.stato="Chiuso";break;default:a.stato=""}return t.automezzo?(a.risorsa=t.automezzo.tipo.descrizione,t.automezzo.targa?a.risorsa+=" "+t.automezzo.targa:a.risorsa+=" #"+t.automezzo.id):t.attrezzatura&&(a.risorsa=t.attrezzatura.tipo.descrizione+" #"+t.attrezzatura.id),a.organizzazione=t.organizzazione?t.organizzazione.denominazione:"",a.indirizzo=t.sede?t.sede.indirizzo:"",a.geom=t.sede?t.sede.geom:"",a.lat=t.sede?t.sede.lat:"",a.lon=t.sede?t.sede.lon:"",e.push(a),t}),e}},{key:"initEngage",value:function(){this.setState({open_engage:!0})}},{key:"callbackEngage",value:function(){console.log("callback"),this.props.refresh&&this.props.refresh()}},{key:"buildStyle",value:function(){var e=new $.default({color:"rgb(255,180,121)"}),t=new Q.default({color:"#cc2e38",width:2});return[new ee.default({image:new ne.default({fill:e,stroke:t,radius:2}),fill:e,stroke:t})]}},{key:"returnedData",value:function(e){var t=this;if(this.vectorLayer||(this.vectorLayer=new K.default({name:"attivabili_"+this.props.evento.id+"_"+S()().format("X"),source:this.vectorSource,style:this.buildStyle()}),this.props.map.addLayer(this.vectorLayer)),e.features.length>0){var a=e.features.map(function(e){e.properties.dist_km=parseFloat(e.properties.dist_km);var t=L.transform([parseFloat(e.properties.lon),parseFloat(e.properties.lat)],"EPSG:4326","EPSG:3857"),a=new Ae.default(t),n=new Je.default({name:e.properties.ref_id,geometry:a});return n.setProperties(e.properties),n});this.vectorSource.addFeatures(a),this.props.dispatch({type:"ADD_GRID",grid:{id:"lista_attivazioni_"+S()().format("X"),onRemove:function(){return t.closedSearchEngage()},layers:[{layer:"Lista attivazioni",layer_identifier:"Risorse ingaggiabili",type:"wfs",feature_key:"ref_id",selectable:!0,event:this.props.evento,cb:function(){return t.callbackEngage()},query:"",features:this.vectorSource.getFeatures()}]}}),this.setState({open_engage:!1,searched:!0})}else N.a.error("Nessun risultato")}},{key:"closedSearchEngage",value:function(){this.props.map.removeLayer(this.vectorLayer),this.setState({searched:!1})}},{key:"canEngage",value:function(){return!(!Ut(this.props.UserStore,"createIngaggio")||"Chiuso"==this.props.evento.stato)}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"ag-theme-balham",style:{height:200}},r.a.createElement(xa.AgGridReact,{columnDefs:this.getColumns(),rowData:this.getData()})),!this.state.searched&&this.canEngage()?r.a.createElement(r.a.Fragment,null,r.a.createElement(Ze.default,{style:{marginTop:12},size:"small",type:"primary",onClick:function(){return e.initEngage()}},"Ingaggia associazioni"),r.a.createElement(Ie.default,{title:"Ingaggia una associazione",width:800,visible:this.state.open_engage,onOk:function(){e.setState({open_engage:!1})},okButtonProps:{style:{display:"none"}},onCancel:function(){return e.setState({open_engage:!1})},cancelText:"Annulla"},r.a.createElement(Ga,{onDone:function(t){return e.returnedData(t)},evento:this.props.evento,tipologia:this.props.evento.id_tipologia,lat:this.props.evento.lat,lon:this.props.evento.lon}))):null)}}]),t}(n.Component),Ta=Object(y.b)(function(e){return{UserStore:e.UserStore,GlobalStore:e.GlobalStore}})(Na),Da=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={event:[],loaded:!1},a.vectorSource=new J.default({wrapX:!1}),a.vectorLayer=null,a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentWillUnmount",value:function(){this.removeLayers()}},{key:"removeLayers",value:function(){this.props.map.removeLayer(this.vectorLayer)}},{key:"getColumns",value:function(){return[{headerName:"",field:"id",width:100,cellRenderer:"GridCellRenderer"},{headerName:"Num. protocollo",field:"num_protocollo",width:100},{headerName:"Stato",field:"stato",width:70},{headerName:"Fonte",field:"fonte",width:70},{headerName:"Tipologia",field:"tipologia",width:100},{headerName:"Indirizzo",field:"indirizzo",width:100},{headerName:"Comune",field:"comune",width:100}]}},{key:"buildStyle",value:function(){var e=new $.default({color:"rgb(255,180,121)"}),t=new Q.default({color:"#cc2e38",width:2});return[new ee.default({image:new ne.default({fill:e,stroke:t,radius:5}),fill:e,stroke:t})]}},{key:"createLayer",value:function(){this.vectorLayer=new K.default({name:"segnalazioni_layer_evento_"+this.props.evento.id,source:this.vectorSource,style:this.buildStyle()}),this.props.map.addLayer(this.vectorLayer)}},{key:"componentDidMount",value:function(){var e=this;this.props.segnalazioni.length>0&&this.props.segnalazioni.map(function(t){var a=new Ae.default([parseFloat(t.lon),parseFloat(t.lat)]),n=new Je.default({name:t.num_protocollo,geometry:a});n.getGeometry().transform("EPSG:4326","EPSG:3857"),n.setProperties(t.viewCartografia),e.vectorSource.addFeature(n)}),this.setState({loaded:!0}),this.createLayer()}},{key:"openPanel",value:function(e){this.props.dispatch({type:"ADD_PANEL",panel:e})}},{key:"render",value:function(){return this.state.loaded?r.a.createElement(r.a.Fragment,null,this.props.segnalazioni.length>0?r.a.createElement(fa.a,{defaultColDef:{enableRowGroup:!0,enablePivot:!0,enableValue:!0,sortable:!0,filter:!0,resizable:!0,width:150,minwidth:100,suppressSizeToFit:!0},context:{componentParent:this,layer:{layer:"postgis:segnalazioni",layer_identifier:"Segnalazioni",type:"wfs",query:"",features:this.vectorSource.getFeatures()}},frameworkComponents:{GridCellRenderer:va},columnDefs:this.getColumns(),map:this.props.map,attributeBlacklist:[],features:this.vectorSource.getFeatures(),selectable:!1,onRowClick:function(e,t){console.log(t)}}):null):null}}]),t}(n.Component),Ia=a(178),Aa=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={event:[],create_event:!1,loaded:!1,area:null},a.vectorSource=null,a.vectorLayer=null,a.vectorSourcePoly=null,a.vectorLayerPoly=null,a.vectorPoly=null,a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentWillUnmount",value:function(){this.removeLayers()}},{key:"removeLayers",value:function(){this.props.map.removeLayer(this.vectorLayer),this.props.map.removeLayer(this.vectorLayerPoly)}},{key:"getColumns",value:function(){return[{headerName:"",field:"id",width:100,cellRenderer:"GridCellRenderer"},{headerName:"Num. protocollo",field:"num_protocollo",width:100},{headerName:"Protocollo evento genitore",field:"protocollo_evento_genitore",width:150},{headerName:"Stato",field:"stato",width:70},{headerName:"Tipologia",field:"tipologia",width:100},{headerName:"Sottotipologia",field:"sottotipologia",width:100},{headerName:"Indirizzo",field:"indirizzo",width:100},{headerName:"Tipo",field:"tipo",width:70},{headerName:"Comune",field:"comune",width:100}]}},{key:"buildStyle",value:function(){var e=new $.default({color:"rgb(255,180,121)"}),t=new Q.default({color:"#cc2e38",width:2});return[new ee.default({image:new ne.default({fill:e,stroke:t,radius:5}),fill:e,stroke:t})]}},{key:"buildPolyStyle",value:function(){var e=new $.default({color:"rgba(255,180,121,.4)"}),t=new Q.default({color:"#cc2e38",width:2});return[new ee.default({image:new ne.default({fill:e,stroke:t,radius:5}),fill:e,stroke:t})]}},{key:"createLayer",value:function(){this.vectorLayer=new K.default({name:"segnalazioni_layer_evento_"+this.props.evento.id,source:this.vectorSource,style:this.buildStyle()}),this.props.map.addLayer(this.vectorLayer)}},{key:"componentDidMount",value:function(){this.initFrontiLayer(this.props)}},{key:"componentWillReceiveProps",value:function(e){e.fronti!=this.props.fronti&&this.initFrontiLayer(e)}},{key:"initFrontiLayer",value:function(e){var t=this;this.vectorSource=new J.default({wrapX:!1}),e.fronti.length>0&&e.fronti.map(function(e){var a=new Ae.default([parseFloat(e.lon),parseFloat(e.lat)]),n=new Je.default({name:e.num_protocollo,geometry:a});n.getGeometry().transform("EPSG:4326","EPSG:3857"),n.setProperties(e.viewCartografia),t.vectorSource.addFeature(n)}),this.setState({loaded:!0}),this.createLayer()}},{key:"openPanel",value:function(e){this.props.dispatch({type:"ADD_PANEL",panel:e})}},{key:"createdEvent",value:function(){Ce(this.props.map),this.setState({create_event:!1}),this.props.refresh&&this.props.refresh()}},{key:"buildPoly",value:function(){this.vectorSourcePoly=new J.default({wrapX:!1});var e=[];this.props.fronti.length>0&&this.props.fronti.map(function(t){var a=L.transform([parseFloat(t.lon),parseFloat(t.lat)],"EPSG:4326","EPSG:3857");e.push(a),console.log("c",a)});var t=new Ve.b([e]),a=new Je.default({geometry:new Ve.b([e]),name:"evento_fronti_poly"});this.vectorSourcePoly.addFeature(a),this.vectorLayerPoly=new K.default({name:"fronti_layer_evento_"+this.props.evento.id,source:this.vectorSourcePoly,style:this.buildPolyStyle()}),this.props.map.addLayer(this.vectorLayerPoly),this.setState({area:Object(Ia.getArea)(t)})}},{key:"canCreateFronte",value:function(){return!(!Ut(this.props.UserStore,"createEvento")||"Chiuso"==this.props.evento.stato)}},{key:"render",value:function(){var e=this;return this.state.loaded?r.a.createElement(r.a.Fragment,null,this.props.fronti.length>0?r.a.createElement(fa.a,{defaultColDef:{enableRowGroup:!0,enablePivot:!0,enableValue:!0,sortable:!0,filter:!0,resizable:!0,width:150,minwidth:100,suppressSizeToFit:!0},height:200,context:{componentParent:this,layer:{layer:"postgis:eventi",layer_identifier:"Eventi",type:"wfs",query:"",features:this.vectorSource.getFeatures()}},frameworkComponents:{GridCellRenderer:va},columnDefs:this.getColumns(),map:this.props.map,attributeBlacklist:[],features:this.vectorSource.getFeatures(),selectable:!1,onRowClick:function(e,t){console.log(t)}}):null,this.canCreateFronte()?r.a.createElement(r.a.Fragment,null,this.state.create_event?r.a.createElement(Rt,{annullate:function(){return e.setState({create_event:!1})},onCreate:function(){return e.createdEvent()},coords:this.props.map.getView().getCenter(),parent:this.props.evento,map:this.props.map}):r.a.createElement(Ze.default,{style:{marginTop:12,marginRight:12},size:"small",type:"primary",onClick:function(){return e.setState({create_event:!0})}},"Inserisci nuovo fronte")):null):null}}]),t}(n.Component),Ma=a(111),qa=a.n(Ma),Ya=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={event:[],loaded:!1},a.vectorSource=new J.default({wrapX:!1}),a.eventFeature=null,a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentWillUnmount",value:function(){this.removeLayers()}},{key:"removeLayers",value:function(){this.props.map.removeLayer(this.vectorLayer)}},{key:"buildStyle",value:function(){var e=new $.default({color:"rgb(255,180,121)"}),t=new Q.default({color:"#cc2e38",width:2});return[new ee.default({image:new ne.default({fill:e,stroke:t,radius:5}),fill:e,stroke:t})]}},{key:"createLayer",value:function(){this.vectorLayer=new K.default({name:"segnalazioni_layer_evento_"+this.props.evento.id,source:this.vectorSource,style:this.buildStyle()}),this.props.map.addLayer(this.vectorLayer)}},{key:"componentDidMount",value:function(){if(console.log(this.props.evento),this.props.evento){var e=new Ae.default([parseFloat(this.props.evento.lon),parseFloat(this.props.evento.lat)]),t=new Je.default({name:this.props.evento.num_protocollo,geometry:e});t.getGeometry().transform("EPSG:4326","EPSG:3857"),t.setProperties(this.props.evento.viewCartografia),this.eventFeature=t,this.vectorSource.addFeature(t)}this.setState({loaded:!0}),this.createLayer()}},{key:"openPanel",value:function(e){this.props.dispatch({type:"ADD_PANEL",panel:e})}},{key:"render",value:function(){return this.state.loaded?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{padding:10}},r.a.createElement("div",{style:{marginBottom:8}},r.a.createElement("b",null,this.props.evento.num_protocollo),r.a.createElement("br",null),r.a.createElement(Pa.a,{status:"Chiuso"==this.props.evento.stato?"error":"success",text:this.props.evento.stato}),r.a.createElement("br",null),this.props.evento.viewCartografia.tipologia),r.a.createElement(qa.a,{feature:this.eventFeature}))):null}}]),t}(n.Component),Va=function(e){return r.a.createElement(qa.a,{feature:e.el.feature})},Ua=ca.a.TabPane,Wa=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={event:[],loaded:!1,changing_position:!1,new_coords:[]},a.vectorSource=null,a.vectorLayer=null,a.feature=null,a.select=null,a.interaction=null,a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.loadEvent()}},{key:"refresh",value:function(){this.loadEvent()}},{key:"loadEvent",value:function(){var e=this;try{this.stopChangePosition(),this.refs.segnalazioni&&this.refs.segnalazioni.removeLayers(),this.refs.fronti&&this.refs.fronti.removeLayers(),this.refs.evento&&this.refs.evento.removeLayers(),this.refs.ingaggi&&this.refs.ingaggi.removeLayers()}catch(t){}zt(this.props.el.row_data.id,function(t){e.setState({event:t.data,loaded:!0}),e.props.changeTitle&&e.props.changeTitle(t.data.viewCartografia.tipo+" num. protocollo "+t.data.num_protocollo)},function(e){console.log("err",e)})}},{key:"componentWillUnmount",value:function(){try{this.stopChangePosition()}catch(e){}}},{key:"buildStyle",value:function(){var e=new $.default({color:"rgb(255,180,121)"}),t=new Q.default({color:"#cc2e38",width:2});return[new ee.default({image:new ne.default({fill:e,stroke:t,radius:10}),fill:e,stroke:t})]}},{key:"createLayer",value:function(){this.vectorSource=new J.default;var e=new Ae.default([parseFloat(this.state.event.lon),parseFloat(this.state.event.lat)]);this.feature=new Je.default({name:"evento_"+this.props.el.row_data.num_protocollo,geometry:e}),this.feature.getGeometry().transform("EPSG:4326","EPSG:3857"),this.feature.setProperties(this.state.event),this.vectorSource.addFeature(this.feature),this.vectorLayer=new K.default({name:"evento_"+this.props.el.row_data.id,source:this.vectorSource,style:this.buildStyle()}),this.vectorLayer.setZIndex(9999999),this.select=new Ct.default({layers:[this.vectorLayer]}),this.interaction=new Pt.default({features:this.select.getFeatures()})}},{key:"initChangePosition",value:function(){var e=this;this.setState({new_coords:[]}),this.vectorLayer||this.createLayer(),this.props.map.addLayer(this.vectorLayer),this.props.map.addInteraction(this.select),this.props.map.addInteraction(this.interaction),this.interaction.on("translateend",function(t){var a=L.transform(t.coordinate,"EPSG:3857","EPSG:4326");e.setState({new_coords:a})}),this.vectorSource=new J.default({wrapX:!1}),this.setState({changing_position:!0})}},{key:"stopChangePosition",value:function(){this.props.map.removeInteraction(this.select),this.props.map.removeInteraction(this.interaction),this.props.map.removeLayer(this.vectorLayer),this.setState({changing_position:!1,new_coords:[]})}},{key:"confirmChangePosition",value:function(){var e=this;this.state.new_coords&&this.state.new_coords[0]&&this.state.new_coords[0]!==this.state.event.lon&&this.state.new_coords[1]&&this.state.new_coords[1]!==this.state.event.lat&&Ot(this.state.event.id,{lat:this.state.new_coords[1],lon:this.state.new_coords[0]},function(t){t.data.id&&(Ce(e.props.map),e.refresh())},function(e){console.log("err",e)})}},{key:"canEdit",value:function(){return!(!Ut(this.props.UserStore,["manageEvento","updateEvento"])||"Chiuso"==this.state.event.stato)}},{key:"render",value:function(){var e=this;return this.state.loaded?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement(Pa.a,{style:{marginBottom:12},status:"Chiuso"===this.state.event.stato?"error":"success",text:this.state.event.stato}),r.a.createElement("br",null),this.canEdit()?r.a.createElement(r.a.Fragment,null,this.state.changing_position?r.a.createElement(r.a.Fragment,null,r.a.createElement(Ze.default,{size:"small",type:"primary",onClick:function(){return e.confirmChangePosition()}},"Conferma"),r.a.createElement(Ze.default,{size:"small",type:"danger",style:{marginLeft:7},onClick:function(){return e.stopChangePosition()}},"Annulla")):r.a.createElement(Ze.default,{size:"small",type:"primary",onClick:function(){return e.initChangePosition()}},r.a.createElement(ra.a,{icon:oa.g,style:{marginRight:8}}),"Modifica posizione")):null),r.a.createElement(ca.a,{defaultActiveKey:"0"},r.a.createElement(Ua,{tab:"Ingaggi",key:"0"},r.a.createElement(Ta,Object.assign({},this.props,{refresh:function(){return e.refresh()},ingaggi:this.state.event.ingaggi,evento:this.state.event}))),r.a.createElement(Ua,{tab:"Segnalazioni",key:"1"},r.a.createElement(Da,Object.assign({ref:"segnalazioni"},this.props,{segnalazioni:this.state.event.segnalazioniAll,evento:this.state.event}))),"Evento"===this.props.el.row_data.tipo?r.a.createElement(Ua,{tab:"Fronti",key:"2"},r.a.createElement(Aa,Object.assign({refresh:function(){return e.refresh()},ref:"fronti"},this.props,{fronti:this.state.event.fronti,evento:this.state.event}))):r.a.createElement(Ua,{tab:"Evento",key:"2"},r.a.createElement(Ya,Object.assign({ref:"genitore"},this.props,{evento:this.state.event.genitore?this.state.event.genitore[0]:null}))),r.a.createElement(Ua,{tab:"Dati",key:"3"},r.a.createElement(Va,Object.assign({},this.props,{evento:this.state.event}))))):null}}]),t}(n.Component),Ba=Object(y.b)(function(e){return{GlobalStore:e.GlobalStore,UserStore:e.UserStore}})(Wa),Xa=function(e){return r.a.createElement(qa.a,{feature:e.el.feature})},Ha=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={event:[],loaded:!1},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"getColumns",value:function(){return[{headerName:"#Id",field:"id",width:100},{headerName:"Targa",field:"targa",width:150},{headerName:"Modello",field:"modello",width:150},{headerName:"Tipo",field:"tipo.descrizione",width:150},{headerName:"Ingaggiata",field:"engaged",width:70},{headerName:"Allestimento",field:"allestimento",width:150},{headerName:"Tempo di attivazione",field:"tempo_attivazione",width:150},{headerName:"Capacit\xe0",field:"capacita",width:150},{headerName:"Classe",field:"classe",width:150},{headerName:"Sottoclasse",field:"sottoclasse",width:150},{headerName:"Data immatricolazione",field:"data_immatricolazione",width:150},{headerName:"Disponibilit\xe0",field:"disponibilita",width:70}]}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.props.organizzazione.automezzi.length>0?r.a.createElement("div",{className:"ag-theme-balham",style:{height:"250px",width:"100%"}},r.a.createElement(xa.AgGridReact,{defaultColDef:{enableRowGroup:!0,enablePivot:!0,enableValue:!0,sortable:!0,filter:!0,resizable:!0,width:150,minwidth:100,suppressSizeToFit:!0},columnDefs:this.getColumns(),rowData:this.props.organizzazione.automezzi})):null)}}]),t}(n.Component),Ka=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={event:[],loaded:!1},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentWillUnmount",value:function(){}},{key:"getColumns",value:function(){return[{headerName:"#Id",field:"id",width:100},{headerName:"Tipo",field:"tipo",width:150},{headerName:"Nome",field:"name",width:150},{headerName:"Indirizzo",field:"indirizzo",width:150},{headerName:"Cap",field:"cap",width:80},{headerName:"Comune",field:"locComune.comune",width:150}]}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.props.organizzazione.automezzi.length>0?r.a.createElement("div",{className:"ag-theme-balham",style:{height:"250px",width:"100%"}},r.a.createElement(xa.AgGridReact,{defaultColDef:{enableRowGroup:!0,enablePivot:!0,enableValue:!0,sortable:!0,filter:!0,resizable:!0,width:150,minwidth:100,suppressSizeToFit:!0},columnDefs:this.getColumns(),rowData:this.props.organizzazione.volSedes})):null)}}]),t}(n.Component),Ja=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={event:[],loaded:!1},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"getColumns",value:function(){return[{headerName:"#Id",field:"id",width:100},{headerName:"Tipo",field:"tipo.descrizione",width:150},{headerName:"Modello",field:"modello",width:150},{headerName:"Ingaggiata",field:"engaged",width:70},{headerName:"Allestimento",field:"allestimento",width:150},{headerName:"Tempo di attivazione",field:"tempo_attivazione",width:150},{headerName:"Capacit\xe0",field:"capacita",width:150},{headerName:"Classe",field:"classe",width:150},{headerName:"Sottoclasse",field:"sottoclasse",width:150},{headerName:"Data immatricolazione",field:"data_immatricolazione",width:150},{headerName:"Disponibilit\xe0",field:"disponibilita",width:70}]}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.props.organizzazione.attrezzature.length>0?r.a.createElement("div",{className:"ag-theme-balham",style:{height:"250px",width:"100%"}},r.a.createElement(xa.AgGridReact,{defaultColDef:{enableRowGroup:!0,enablePivot:!0,enableValue:!0,sortable:!0,filter:!0,resizable:!0,width:150,minwidth:100,suppressSizeToFit:!0},columnDefs:this.getColumns(),rowData:this.props.organizzazione.attrezzature})):null)}}]),t}(n.Component),Za=ca.a.TabPane,$a=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={segnalazione:{},loaded:!1,changing_position:!1,new_coords:[]},a.vectorSource=null,a.vectorLayer=null,a.feature=null,a.select=null,a.interaction=null,a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.loadOrganizzazione()}},{key:"refresh",value:function(){this.loadOrganizzazione()}},{key:"loadOrganizzazione",value:function(){var e=this;It(this.props.el.row_data.id,function(t){console.log("organizzazione",t),e.setState({organizzazione:t.data,loaded:!0}),e.props.changeTitle&&e.props.changeTitle("Organizzazione "+t.data.denominazione)},function(e){console.log("err",e)})}},{key:"componentWillUnmount",value:function(){try{this.stopChangePosition()}catch(e){}}},{key:"buildStyle",value:function(){var e=new $.default({color:"rgb(255,180,121)"}),t=new Q.default({color:"#cc2e38",width:2});return[new ee.default({image:new ne.default({fill:e,stroke:t,radius:10}),fill:e,stroke:t})]}},{key:"createLayer",value:function(){this.vectorSource=new J.default;var e=new Ae.default([parseFloat(this.state.organizzazione.lon),parseFloat(this.state.organizzazione.lat)]);this.feature=new Je.default({name:"organizzazione_"+this.props.el.row_data.id,geometry:e}),this.feature.getGeometry().transform("EPSG:4326","EPSG:3857"),this.feature.setProperties(this.state.organizzazione),this.vectorSource.addFeature(this.feature),this.vectorLayer=new K.default({name:"evento_"+this.props.el.row_data.id,source:this.vectorSource,style:this.buildStyle()}),this.vectorLayer.setZIndex(9999999),this.select=new Ct.default({layers:[this.vectorLayer]}),this.interaction=new Pt.default({features:this.select.getFeatures()})}},{key:"render",value:function(){return this.state.loaded?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement(ca.a,{defaultActiveKey:"1"},r.a.createElement(Za,{tab:"Automezzi",key:"1"},r.a.createElement(Ha,Object.assign({},this.props,{ref:"automezzi",organizzazione:this.state.organizzazione,map:this.props.map}))),r.a.createElement(Za,{tab:"Attrezzature",key:"2"},r.a.createElement(Ja,Object.assign({},this.props,{ref:"attrezzature",organizzazione:this.state.organizzazione,map:this.props.map}))),r.a.createElement(Za,{tab:"Sedi",key:"3"},r.a.createElement(Ka,Object.assign({},this.props,{ref:"sedi",organizzazione:this.state.organizzazione,map:this.props.map}))),r.a.createElement(Za,{tab:"Dati",key:"4"},r.a.createElement(Xa,Object.assign({},this.props,{organizzazione:this.state.organizzazione})))))):null}}]),t}(n.Component),Qa=Object(y.b)(function(e){return{GlobalStore:e.GlobalStore}})($a),en=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={ft:null,loaded:!1},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.setProps()}},{key:"refresh",value:function(){}},{key:"setProps",value:function(){var e=this.props.el.feature.clone(),t=e.getProperties();Object.keys(t).map(function(e){Array.isArray(t[e])&&(t[e]="contattiAttivazioni"==e?"":t[e].map(function(e){return e.contatto.contatto}))}),e.setProperties(t,!0),this.setState({ft:e}),this.props.changeTitle&&this.props.changeTitle("Risorsa: "+t.ref_tipo_descrizione+" - "+t.denominazione_organizzazione)}},{key:"render",value:function(){return this.state.ft?r.a.createElement(qa.a,{feature:this.state.ft}):null}}]),t}(n.Component),tn=Object(y.b)(function(e){return{GlobalStore:e.GlobalStore}})(en),an=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).invokeParentMethod=a.invokeParentMethod.bind(Object(ga.a)(a)),a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"invokeParentMethod",value:function(){this.props.context.componentParent.methodFromParent("Row: ".concat(this.props.node.rowIndex,", Col: ").concat(this.props.colDef.headerName))}},{key:"open",value:function(){this.props.context.componentParent.openPanel({id:this.props.context.layer.layer_identifier+"_"+this.props.data.id,layer_name:this.props.context.layer.layer_identifier,layer:this.props.context.layer.layer,row_data:this.props.data,feature:this.props.context.layer.features[this.props.node.rowIndex]})}},{key:"center",value:function(){this.props.context.componentParent.props.map.getView().fit(this.props.context.layer.features[this.props.node.rowIndex].getGeometry().getExtent().slice(0),{maxZoom:15})}},{key:"canLink",value:function(){var e="";try{e=this.props.componentParent.props.el.row_data.stato}catch(t){console.warn("errore cell eventi",this.props)}return!(!Ut(this.props.context.UserStore,"transformSegnalazioneToEvento")||"Nuova in lavorazione"!=e)}},{key:"attach",value:function(){this.props.context.componentParent.attachEvent(this.props.data)}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ze.default,{icon:"eye",size:"small",style:{},onClick:function(){return e.open()}}),r.a.createElement(Ze.default,{icon:"pushpin",size:"small",style:{marginLeft:6},onClick:function(){return e.center()}}),this.canLink()?r.a.createElement(Ze.default,{icon:"link",size:"small",style:{marginLeft:6},onClick:function(){return e.attach()}}):null)}}]),t}(n.Component),nn=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={event:[],loaded:!1},a.vectorSource=new J.default({wrapX:!1}),a.vectorLayer=null,a.vectorPoly=null,a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentWillUnmount",value:function(){this.removeLayers()}},{key:"removeLayers",value:function(){this.props.map.removeLayer(this.vectorLayer)}},{key:"getColumns",value:function(){return[{headerName:"",field:"id",width:150,cellRenderer:"GridCellAttachEventRenderer"},{headerName:"Num. protocollo",field:"num_protocollo",width:100},{headerName:"Protocollo evento genitore",field:"protocollo_evento_genitore",width:150},{headerName:"Stato",field:"stato",width:70},{headerName:"Tipologia",field:"tipologia",width:100},{headerName:"Sottotipologia",field:"sottotipologia",width:100},{headerName:"Indirizzo",field:"indirizzo",width:100},{headerName:"Tipo",field:"tipo",width:70},{headerName:"Comune",field:"comune",width:100}]}},{key:"attachEvent",value:function(e){var t=this,a=e.id;Dt(this.props.segnalazione.id,a,function(e){t.props.refresh&&t.props.refresh()},function(e){console.log("err",e)})}},{key:"buildStyle",value:function(){var e=new $.default({color:"rgb(255,180,121)"}),t=new Q.default({color:"#cc2e38",width:2});return[new ee.default({image:new ne.default({fill:e,stroke:t,radius:5}),fill:e,stroke:t})]}},{key:"createLayer",value:function(){this.vectorLayer=new K.default({name:"eventi_vicini_layer_segnalazione_"+this.props.el.row_data.id,source:this.vectorSource,style:this.buildStyle()}),this.props.map.addLayer(this.vectorLayer)}},{key:"componentDidMount",value:function(){var e=this;this.props.eventi.length>0&&this.props.eventi.map(function(t){var a=new Ae.default([parseFloat(t.lon),parseFloat(t.lat)]),n=new Je.default({name:t.num_protocollo,geometry:a});n.getGeometry().transform("EPSG:4326","EPSG:3857"),n.setProperties(t.viewCartografia),e.vectorSource.addFeature(n)}),this.setState({loaded:!0}),this.createLayer()}},{key:"openPanel",value:function(e){this.props.dispatch({type:"ADD_PANEL",panel:e})}},{key:"render",value:function(){return this.state.loaded?r.a.createElement(r.a.Fragment,null,this.props.eventi.length>0?r.a.createElement(fa.a,{defaultColDef:{enableRowGroup:!0,enablePivot:!0,enableValue:!0,sortable:!0,filter:!0,resizable:!0,width:150,minwidth:100,suppressSizeToFit:!0},context:{componentParent:this,UserStore:this.props.UserStore,layer:{layer:"postgis:eventi",layer_identifier:"Eventi",type:"wfs",query:"",features:this.vectorSource.getFeatures()}},frameworkComponents:{GridCellAttachEventRenderer:an},columnDefs:this.getColumns(),map:this.props.map,attributeBlacklist:[],features:this.vectorSource.getFeatures(),selectable:!1,onRowClick:function(e,t){console.log(t)}}):null):null}}]),t}(n.Component),rn=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={event:[],loaded:!1},a.vectorSource=new J.default({wrapX:!1}),a.eventFeature=null,a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentWillUnmount",value:function(){this.removeLayers()}},{key:"removeLayers",value:function(){this.props.map.removeLayer(this.vectorLayer)}},{key:"buildStyle",value:function(){var e=new $.default({color:"rgb(255,180,121)"}),t=new Q.default({color:"#cc2e38",width:2});return[new ee.default({image:new ne.default({fill:e,stroke:t,radius:5}),fill:e,stroke:t})]}},{key:"createLayer",value:function(){this.vectorLayer=new K.default({name:"evento_genitore_layer_segnalazione_"+this.props.evento.id,source:this.vectorSource,style:this.buildStyle()}),this.props.map.addLayer(this.vectorLayer)}},{key:"componentDidMount",value:function(){if(this.props.evento){var e=new Ae.default([parseFloat(this.props.evento.lon),parseFloat(this.props.evento.lat)]),t=new Je.default({name:this.props.evento.num_protocollo,geometry:e});t.getGeometry().transform("EPSG:4326","EPSG:3857"),t.setProperties(this.props.evento.viewCartografia),this.eventFeature=t,this.vectorSource.addFeature(t)}this.setState({loaded:!0}),this.createLayer()}},{key:"openPanel",value:function(e){this.props.dispatch({type:"ADD_PANEL",panel:e})}},{key:"render",value:function(){return this.state.loaded?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{padding:10}},r.a.createElement("div",{style:{marginBottom:8}},r.a.createElement("b",null,this.props.evento.num_protocollo),r.a.createElement("br",null),r.a.createElement(Pa.a,{status:"Chiuso"==this.props.evento.stato?"error":"success",text:this.props.evento.stato}),r.a.createElement("br",null),this.props.evento.viewCartografia.tipologia),r.a.createElement(qa.a,{feature:this.eventFeature}))):null}}]),t}(n.Component),on=function(e){return r.a.createElement(qa.a,{feature:e.el.feature})},sn=function(e){return r.a.createElement("img",{src:(t=e.segnalazione,window.base_api_url+"v1/media/view-media/"+t.foto_id),alt:"",style:{width:"100%",height:"auto"}});var t},ln=ca.a.TabPane,cn=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={segnalazione:{},loaded:!1,changing_position:!1,new_coords:[]},a.vectorSource=null,a.vectorLayer=null,a.feature=null,a.select=null,a.interaction=null,a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.loadSegnalazione()}},{key:"refresh",value:function(){this.loadSegnalazione()}},{key:"loadSegnalazione",value:function(){var e=this;try{this.stopChangePosition(),this.refs.evento&&this.refs.evento.removeLayers(),this.refs.eventi_vicini&&this.refs.eventi_vicini.removeLayers()}catch(t){}Gt(this.props.el.row_data.id,function(t){console.log("segnalazione",t),e.setState({segnalazione:t.data,loaded:!0}),e.props.changeTitle&&e.props.changeTitle("Segnalazione num. protocollo "+t.data.num_protocollo)},function(e){console.log("err",e)})}},{key:"componentWillUnmount",value:function(){try{this.stopChangePosition()}catch(e){}}},{key:"buildStyle",value:function(){var e=new $.default({color:"rgb(255,180,121)"}),t=new Q.default({color:"#cc2e38",width:2});return[new ee.default({image:new ne.default({fill:e,stroke:t,radius:10}),fill:e,stroke:t})]}},{key:"createLayer",value:function(){this.vectorSource=new J.default;var e=new Ae.default([parseFloat(this.state.segnalazione.lon),parseFloat(this.state.segnalazione.lat)]);this.feature=new Je.default({name:"evento_"+this.props.el.row_data.num_protocollo,geometry:e}),this.feature.getGeometry().transform("EPSG:4326","EPSG:3857"),this.feature.setProperties(this.state.segnalazione),this.vectorSource.addFeature(this.feature),this.vectorLayer=new K.default({name:"evento_"+this.props.el.row_data.id,source:this.vectorSource,style:this.buildStyle()}),this.vectorLayer.setZIndex(9999999),this.select=new Ct.default({layers:[this.vectorLayer]}),this.interaction=new Pt.default({features:this.select.getFeatures()})}},{key:"initChangePosition",value:function(){var e=this;this.setState({new_coords:[]}),this.vectorLayer||this.createLayer(),this.props.map.addLayer(this.vectorLayer),this.props.map.addInteraction(this.select),this.props.map.addInteraction(this.interaction),this.interaction.on("translateend",function(t){var a=L.transform(t.coordinate,"EPSG:3857","EPSG:4326");e.setState({new_coords:a})}),this.vectorSource=new J.default({wrapX:!1}),this.setState({changing_position:!0})}},{key:"stopChangePosition",value:function(){this.props.map.removeInteraction(this.select),this.props.map.removeInteraction(this.interaction),this.props.map.removeLayer(this.vectorLayer),this.setState({changing_position:!1,new_coords:[]})}},{key:"confirmChangePosition",value:function(){var e=this;this.state.new_coords&&this.state.new_coords[0]&&this.state.new_coords[0]!==this.state.segnalazione.lon&&this.state.new_coords[1]&&this.state.new_coords[1]!==this.state.segnalazione.lat&&Nt(this.state.segnalazione.id,{lat:this.state.new_coords[1],lon:this.state.new_coords[0]},function(t){t.data.id&&(Ce(e.props.map),e.refresh())},function(e){console.log("err",e)})}},{key:"render",value:function(){var e=this;return this.state.loaded?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement(Pa.a,{style:{marginBottom:12},status:"Chiusa"===this.state.segnalazione.stato?"error":"success",text:this.state.segnalazione.stato}),r.a.createElement("br",null),"Nuova in lavorazione"==this.state.segnalazione.stato&&Ut(this.props.UserStore,"updateSegnalazione")?r.a.createElement(r.a.Fragment,null,this.state.changing_position?r.a.createElement(r.a.Fragment,null,r.a.createElement(Ze.default,{size:"small",type:"primary",onClick:function(){return e.confirmChangePosition()}},"Conferma"),r.a.createElement(Ze.default,{size:"small",type:"danger",style:{marginLeft:7},onClick:function(){return e.stopChangePosition()}},"Annulla")):r.a.createElement(Ze.default,{size:"small",type:"primary",onClick:function(){return e.initChangePosition()}},r.a.createElement(ra.a,{icon:oa.g,style:{marginRight:8}}),"Modifica posizione")):null),r.a.createElement(ca.a,{defaultActiveKey:"1"},this.state.segnalazione.evento?r.a.createElement(ln,{tab:"Evento",key:"1"},r.a.createElement(rn,Object.assign({ref:"evento"},this.props,{evento:this.state.segnalazione.evento}))):r.a.createElement(ln,{tab:"Eventi vicini",key:"1"},r.a.createElement(nn,Object.assign({ref:"eventi_vicini"},this.props,{eventi:this.state.segnalazione.eventi_vicini,segnalazione:this.state.segnalazione,refresh:function(){return e.refresh()}}))),r.a.createElement(ln,{tab:"Foto",key:"3"},this.state.segnalazione.viewCartografia.foto_url&&""!==this.state.segnalazione.viewCartografia.foto_url?r.a.createElement(sn,{segnalazione:this.state.segnalazione.viewCartografia}):null),r.a.createElement(ln,{tab:"Dati",key:"4"},r.a.createElement(on,Object.assign({},this.props,{segnalazione:this.state.segnalazione}))))):null}}]),t}(n.Component),un=Object(y.b)(function(e){return{GlobalStore:e.GlobalStore,UserStore:e.UserStore}})(cn),pn=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.props.changeTitle&&this.props.changeTitle("Informazioni")}},{key:"render",value:function(){return r.a.createElement(qa.a,{feature:this.props.feature})}}]),t}(n.Component),dn=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={grids:[],title:""},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"returnPanel",value:function(e){var t=this;switch(e.layer_name){case"Eventi":case"Eventi chiusi":return r.a.createElement(Ba,{changeTitle:function(e){return t.setState({title:e})},el:e,map:this.props.map});case"Segnalazioni":case"Segnalazioni chiuse":return r.a.createElement(un,{changeTitle:function(e){return t.setState({title:e})},el:e,map:this.props.map});case"Organizzazioni":return r.a.createElement(Qa,{changeTitle:function(e){return t.setState({title:e})},el:e,map:this.props.map});case"Risorsa":return r.a.createElement(tn,{changeTitle:function(e){return t.setState({title:e})},el:e,map:this.props.map});default:return r.a.createElement(pn,{changeTitle:function(e){return t.setState({title:e})},feature:e.feature})}}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,this.props.SearchStore.panels.filter(function(e){return!e.position}).map(function(t){var a,n;return r.a.createElement(pa.a,{key:"panel_"+t.id,style:{position:"absolute",backgroundColor:"#fff"},x:200,y:150,width:500,height:437,title:e.state.title,draggable:!0,tools:[r.a.createElement(Ze.default,(a={key:"to_left",name:"borderLeft",size:"small",ghost:!0,icon:"border-left"},Object(la.a)(a,"ghost",!0),Object(la.a)(a,"style",{marginLeft:10}),Object(la.a)(a,"type","primary"),Object(la.a)(a,"onClick",function(){e.props.dispatch({type:"PANEL_TO_LEFT",id:t.id})}),a)),r.a.createElement(Ze.default,(n={key:"to_right",name:"borderRight",size:"small",ghost:!0,icon:"border-right"},Object(la.a)(n,"ghost",!0),Object(la.a)(n,"style",{marginLeft:10}),Object(la.a)(n,"type","primary"),Object(la.a)(n,"onClick",function(){e.props.dispatch({type:"PANEL_TO_RIGHT",id:t.id})}),n)),r.a.createElement(G.a,{key:"key_btn",name:"clearSearch",size:"small",ghost:!0,icon:"close",style:{marginLeft:10},type:"danger",onClick:function(){t.onRemove&&t.onRemove(),e.props.dispatch({type:"REMOVE_PANEL",id:t.id})}})],resizeOpts:{top:!1,right:!0,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1}},r.a.createElement("div",{style:{height:415,overflow:"auto"}},e.returnPanel(t)))}))}}]),t}(n.Component),hn=Object(y.b)(function(e){return{SearchStore:e.SearchStore}})(dn),mn=a(640),fn=a.n(mn),gn=[],vn=0;function yn(){gn.forEach(function(e){return e(vn>0)})}function bn(){vn-=1,yn()}var _n=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(){vn+=1,yn(),this.addEventListener("load",bn),this.addEventListener("error",bn),this.addEventListener("abort",bn),this.addEventListener("timeout",bn);for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];_n.apply(this,t)};var wn=a(641),Sn=a.n(wn),kn=a(642),En=a.n(kn),zn=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={current_active:"",layers:[]},a.map_layers=["Ortofoto 2012 RealVista","Ortofoto 2012 PCN Minambiente","Local OpenStreetMap","OpenStreetMap"],a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.getMapLayers()}},{key:"getMapLayers",value:function(){var e=Object(c.a)(l.a.mark(function e(){var t,a=this;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[],je(this.props.map).map(function(){var e=Object(c.a)(l.a.mark(function e(n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.getVisible()&&a.setState({current_active:n.get("name")}),t.push(n);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),this.setState({layers:t});case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isActive",value:function(e){return e===this.state.current_active}},{key:"onChange",value:function(e){var t=this,a=e.target.value;"Google map"===a?(this.state.layers.map(function(e){return e.getVisible()&&e.setVisible(!1),e.get("name")===a&&e.setVisible(!0),null}),this.props.gmap.toggle()):this.state.layers.map(function(e){return e.getVisible()&&e.get("name")!==a&&(e.setVisible(!1),"Google map"===e.get("name")&&t.props.gmap.toggle()),e.get("name")===a&&e.setVisible(!0),null}),this.setState({current_active:a})}},{key:"activate",value:function(e){var t=e.get("name");this.state.layers.map(function(e){return e.getVisible()&&e.get("name")!==t&&e.setVisible(!1),e.get("name")===t&&e.setVisible(!0),null}),this.setState({current_active:t})}},{key:"getMapIcon",value:function(e){switch(e.icon){case"osm":return r.a.createElement("img",{className:"icon_map",src:Sn.a,alt:"osm"});case"realvista":return r.a.createElement("img",{className:"icon_map",src:En.a,alt:"realvista"});default:return""}}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"tiles",style:{position:"absolute",top:10,left:45,zIndex:3}},this.state.layers.map(function(t,a,n){return r.a.createElement("div",{onClick:function(){return e.activate(t)},key:"map_icon"+a,className:e.isActive(t.get("name"))?"map_icon_container active":"map_icon_container"},e.getMapIcon(t.get("configuration_object")))})))}}]),t}(n.Component),On=(a(613),a(127)),jn=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={active:null,selected:[]},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){}},{key:"resize",value:function(){var e=this;setTimeout(function(){e.props.map.updateSize()},500)}},{key:"onMenuClick",value:function(e){if(-1!==this.state.selected.indexOf(e.key))console.log("chiudo"),this.props.dispatch({type:"OPEN_SIDEBAR",element:null}),this.setState({selected:[]}),this.resize();else{switch(e.key){case"draw":this.props.dispatch({type:"OPEN_SIDEBAR",element:"draw"}),this.setState({selected:[e.key]});break;case"search":this.props.dispatch({type:"OPEN_SIDEBAR",element:"search"}),this.setState({selected:[e.key]});break;case"layers":this.props.dispatch({type:"OPEN_SIDEBAR",element:"layers"}),this.setState({selected:[e.key]});break;case"print":this.props.dispatch({type:"OPEN_SIDEBAR",element:null}),this.setState({selected:[]}),this.print()}this.resize()}}},{key:"print",value:function(){this.props.map.once("rendercomplete",function(e){var t=e.context.canvas;try{navigator.msSaveBlob?navigator.msSaveBlob(t.msToBlob(),"map.png"):t.toBlob(function(e){ha.a.saveAs(e,"map.png")})}catch(a){alert("Non \xe8 possibile stampare la mappa, probabilmente un problema di CORS, contatta l'assistenza")}}),this.props.map.renderSync()}},{key:"render",value:function(){var e=this;return r.a.createElement(f.a.Sider,{className:"sidebar",breakpoint:"lg",collapsedWidth:"0",onBreakpoint:function(e){console.log(e)},onCollapse:function(e,t){console.log(e,t)},width:50,style:{background:"#00264d"}},r.a.createElement(On.b,{theme:"dark",selectedKeys:this.state.selected,style:{backgroundColor:"#00264d"},onClick:function(t){return e.onMenuClick(t)}},r.a.createElement(On.b.Item,{key:"draw"},r.a.createElement(ra.a,{icon:oa.h})),r.a.createElement(On.b.Item,{key:"search"},r.a.createElement(ra.a,{icon:oa.k})),r.a.createElement(On.b.Item,{key:"layers"},r.a.createElement(ra.a,{icon:oa.f})),r.a.createElement(On.b.Item,{key:"print",selectable:!1},r.a.createElement(ra.a,{icon:oa.i}))))}}]),t}(n.Component),Cn=Object(y.b)(function(e){return{GlobalStore:e.GlobalStore}})(jn),Pn=a(464),xn=a.n(Pn),Ln=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={group:null},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=new U.default({name:"Dynamic"});Oe(this.props.map).map(function(e){return t.getLayers().getArray().push(e)}),this.setState({group:t},function(){var t=e.refs.layer_tree.onLayerChangeVisible;e.refs.layer_tree.onLayerChangeVisible=function(){t(),e.props.map.updateSize()}})}},{key:"getLegendableLayers",value:function(){return ke(this.props.map)}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{height:"100%",width:"100%",overflow:"auto"}},this.state.group?r.a.createElement(v.LayerTree,{ref:"layer_tree",layerGroup:this.state.group,map:this.props.map,draggable:!1}):null,r.a.createElement("div",null,this.getLegendableLayers().map(function(e,t,a){return r.a.createElement("div",{key:"legend_"+t,style:{padding:8}},r.a.createElement("h4",null,e.get("name")),r.a.createElement(xn.a,{layer:e}))}))))}}]),t}(n.Component),Fn=(a(323),a(257)),Rn=a(49),Gn=a(643),Nn=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={grids:[]},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"buildGrid",value:function(e){this.setState({grids:[].concat(Object(z.a)(this.state.grids),[{id:this.state.grids.length+1,features:e}])})}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,this.state.grids.map(function(t){return r.a.createElement(pa.a,{key:"grid_"+t.id,style:{position:"absolute",backgroundColor:"#fff"},x:100,y:100,width:500,height:400,title:"Risultato della ricerca",collapsible:!0,draggable:!0,tools:[r.a.createElement(G.a,{key:"key_btn",name:"clearSearch",size:"small",ghost:!0,icon:"close",style:{marginLeft:10},type:"danger",onClick:function(){return e.setState({grids:e.state.grids.filter(function(e){return e.id!==t.id})})}})],resizeOpts:{top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1}},r.a.createElement(fa.a,{defaultColDef:{enableRowGroup:!0,enablePivot:!0,enableValue:!0,sortable:!0,filter:!0,resizable:!0,width:150,minwidth:100,suppressSizeToFit:!0},map:e.props.map,attributeBlacklist:[],features:t.features,selectable:!1,onRowClick:function(e){return console.log("row",e)}}))}))}}]),t}(n.Component),Tn=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={searchableLayers:["Eventi","Organizzazioni"]},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"initSearch",value:function(e,t,a){var n=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=null;o="WITHIN"===e?window.base_geoserver_url+"/wfs?version=1.0.0&request=GetFeature&typeName=postgis:eventi&maxFeatures=50&outputFormat=application%2Fjson&CQL_FILTER="+e+"(geom,"+t+")":window.base_geoserver_url+"/wfs?version=1.0.0&request=GetFeature&typeName=postgis:eventi&maxFeatures=50&outputFormat=application%2Fjson&CQL_FILTER="+e+"(geom,"+t+","+r+",meters)";var i=this.props.map.getLayerGroup().getLayersArray(),s=[];i.forEach(function(e){console.log(e.get("name"),e.getVisible()),e.getVisible()&&n.state.searchableLayers.includes(e.get("name"))&&s.push(e)}),fetch(o).then(function(e){return e.json()}).then(function(e){if(n.setState({selectionDone:!0}),e.totalFeatures>0)for(var t=0;t<e.totalFeatures;t++){var r=(new V.default).readFeatureFromObject(e.features[t]);r.getGeometry().transform("EPSG:4326","EPSG:3857"),a.addFeature(r)}n.state.selectionDone&&(n.props.map.addInteraction(n.props.selectClick),n.props.selectClick.on("select",function(e){console.log("FeatureSelected",e.target.getFeatures())})),n.refs.grids_component.buildGrid(a.getFeatures())}).catch(function(e){console.warn(e)})}},{key:"render",value:function(){return r.a.createElement(Nn,{ref:"grids_component",map:this.props.map})}}]),t}(n.Component),Dn=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={pointBtnPos:50,circleBtnPos:50,squareBtnPos:10,btnsOpacity:100,btnsVisible:!1,searchType:null,modalIsOpen:!1,clearSearchPos:50,selectionDone:!1,drawing:!1,openModalRange:!1,range:1,searched:!1,searchFeatures:[],selected:[]},a.draw=null,a.selectionSource=null,a.selectionLayer=null,a.drawLayer=null,a.drawSource=null,a.selectClick=null,a.geom=null,a.geomWKT=null,a.searchTypeChange=function(e){a.setState({searchType:e}),a.clearSearch();var t=null;"point"===e&&(t="Point"),"circle"===e&&(t="Circle"),"square"===e&&(t="Polygon"),a.draw=new Fn.default({type:t,source:a.drawSource}),a.props.map.addInteraction(a.draw),a.setState({drawing:!0}),a.draw.on("drawend",function(e){a.prepareSearch(e.feature.clone())})},a.showButtons=function(){a.state.btnsVisible?(a.setState({pointBtnPos:10,circleBtnPos:10,squareBtnPos:10,clearSearchPos:10,btnsOpacity:0,btnsVisible:!1}),null!=a.draw&&a.props.map.removeInteraction(a.draw),a.state.selectionDone&&(a.props.map.removeInteraction(a.selectClick),a.clearSearch())):a.setState({pointBtnPos:60,circleBtnPos:110,squareBtnPos:160,clearSearchPos:210,btnsOpacity:1,btnsVisible:!0}),a.setState({searchType:null})},a.clearSelection=function(){a.drawSource.clear(),a.selectionSource.clear(),a.setState({searched:!1}),a.state.selectionDone&&(a.props.map.removeInteraction(a.selectClick),a.setState({selectionDone:!1}))},a.clearSearch=function(){a.setState({searched:!1}),a.drawSource.clear(),a.selectionSource.clear(),a.state.drawing&&(a.props.map.removeInteraction(a.draw),a.setState({drawing:!1,searched:!1}))},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.selectionSource=new J.default({wrapX:!1}),this.drawSource=new J.default({wrapX:!1});var e=new $.default({color:"rgb(255,180,121)"}),t=new Q.default({color:"#cc2e38",width:2}),a=[new ee.default({image:new ne.default({fill:e,stroke:t,radius:5}),fill:e,stroke:t})];this.selectionLayer=new K.default({name:"selection",source:this.selectionSource,map:this.props.map,style:a}),this.drawLayer=new K.default({name:"drawing",source:this.drawSource,map:this.props.map}),this.selectClick=new Ct.default({condition:Rn.click,layers:function(e){return"selection"===e.get("name")}})}},{key:"componentWillUnmount",value:function(){this.clearSearch()}},{key:"prepareSearch",value:function(e){var t=new Ue.a,a=this.props.map.getView().getProjection().getUnits(),n=this.props.map.getView().getResolution();switch(this.state.searchType){case"circle":this.geom=e.getGeometry();var r=new Ae.default(this.geom.getCenter());this.geomWKT=t.writeGeometryText(r.transform("EPSG:3857","EPSG:4326")),this.doSearch("DWITHIN",L.METERS_PER_UNIT[a]*this.geom.getRadius(),e);break;case"point":this.geom=e.getGeometry().transform("EPSG:3857","EPSG:4326"),this.geomWKT=t.writeGeometryText(this.geom);console.log(this.geomWKT),this.doSearch("DWITHIN",n*L.METERS_PER_UNIT[a]*5,e);break;case"square":this.geom=e.getGeometry().transform("EPSG:3857","EPSG:4326"),this.geomWKT=t.writeGeometryText(this.geom),this.doSearch("WITHIN",null,e)}}},{key:"doSearch",value:function(){var e=Object(c.a)(l.a.mark(function e(t){var a,n,r,o,i=arguments;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>1&&void 0!==i[1]?i[1]:null,n=i.length>2&&void 0!==i[2]?i[2]:null,this.props.map.removeInteraction(this.draw),r=S()().format("X")+"_search_"+Math.floor(1e5*Math.random()),e.next=6,Ke.searchFeatures(t,a,this.geomWKT,this.props.map,this.geom,n);case 6:(o=e.sent).length>0&&this.props.dispatch({type:"ADD_GRID",grid:{id:r,layers:o}}),console.log("risultati",o);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onMenuClick",value:function(e){if(this.state.selected==e.key)this.clearSearch();else switch(e.key){case"point":case"circle":case"square":this.searchTypeChange(e.key),this.setState({selected:[e.key]});break;case"clear":this.clearSearch(),this.setState({selected:[]})}}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(On.b,{theme:"light",className:"icon_menu",selectedKeys:this.state.selected,style:{backgroundColor:"#fff"},onClick:function(t){return e.onMenuClick(t)}},r.a.createElement(On.b.Item,{key:"point",style:{padding:"14px 30px 48px 30px"}},r.a.createElement(ra.a,{icon:oa.g,style:{fontSize:23,color:"#b2d8ff"},className:"icon_button"})),r.a.createElement(On.b.Item,{key:"circle",style:{padding:"14px 30px 48px 30px"}},r.a.createElement(ra.a,{icon:Gn.a,style:{fontSize:23,color:"#b2d8ff"},className:"icon_button"})),r.a.createElement(On.b.Item,{key:"square",style:{padding:"14px 30px 48px 30px"}},r.a.createElement(ra.a,{icon:oa.b,style:{fontSize:23,color:"#b2d8ff"},className:"icon_button"})),r.a.createElement(On.b.Item,{key:"clear",selectable:!1,style:{padding:"14px 30px 48px 30px"}},r.a.createElement(ra.a,{icon:oa.l,style:{fontSize:23,color:"#b2d8ff"},className:"icon_button"}))),r.a.createElement(Ie.default,{title:"Inserisci il raggio (metri):",visible:this.state.openModalRange,onOk:function(){e.setState({openModalRange:!1}),e.doSearch("DWITHIN",e.state.range)},onCancel:function(){return e.setState({openModalRange:!1})}},r.a.createElement(nt.a,{size:"large",style:{width:"100%"},min:1,max:1e5,step:100,onChange:function(t){return e.setState({range:t})}})),r.a.createElement(Tn,{ref:"search_component",map:this.props.map,draw:this.draw,selectClick:this.selectClick}))}}]),t}(n.Component),In=Object(y.b)(function(e){return{SearchStore:e.SearchStore}})(Dn),An=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={active:null},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"getWidth",value:function(){return this.props.GlobalStore&&this.props.GlobalStore.sidebar_element?"layers"===this.props.GlobalStore.sidebar_element?300:80:0}},{key:"getElement",value:function(){switch(this.props.GlobalStore.sidebar_element){case"layers":return r.a.createElement(Ln,{map:this.props.map});case"draw":return r.a.createElement(sa,{map:this.props.map});case"search":return r.a.createElement(In,{map:this.props.map});default:return null}}},{key:"render",value:function(){return r.a.createElement(f.a.Sider,{className:"sidebar",breakpoint:"lg",collapsedWidth:"0",onBreakpoint:function(e){},onCollapse:function(e,t){},width:this.getWidth(),style:{background:"#fff"}},r.a.createElement("div",{style:{height:"100%",width:"100%"}},this.getElement()))}}]),t}(n.Component),Mn=Object(y.b)(function(e){return{GlobalStore:e.GlobalStore}})(An),qn=ca.a.TabPane,Yn=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={active:null},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"getWidth",value:function(){return this.props.SearchStore.grids.filter(function(e){return"left"==e.position}).length>0||this.props.SearchStore.panels.filter(function(e){return"left"==e.position}).length>0?300:0}},{key:"componentWillReceiveProps",value:function(e){e.SearchStore.grids.filter(function(e){return"left"===e.position})===this.props.SearchStore.grids.filter(function(e){return"left"===e.position})&&e.SearchStore.panels.filter(function(e){return"left"===e.position})===this.props.SearchStore.panels.filter(function(e){return"left"===e.position})||this.resize()}},{key:"resize",value:function(){var e=this;setTimeout(function(){e.props.map.updateSize()},500)}},{key:"returnPanel",value:function(e){var t=this;switch(e.layer_name){case"Eventi":case"Eventi chiusi":return r.a.createElement(Ba,{changeTitle:function(e){return t.setState({title:e})},el:e,map:this.props.map});case"Segnalazioni":case"Segnalazioni chiuse":return r.a.createElement(un,{changeTitle:function(e){return t.setState({title:e})},el:e,map:this.props.map});case"Organizzazioni":return r.a.createElement(Qa,{changeTitle:function(e){return t.setState({title:e})},el:e,map:this.props.map});case"Risorsa":return r.a.createElement(tn,{changeTitle:function(e){return t.setState({title:e})},el:e,map:this.props.map});default:return r.a.createElement(pn,{changeTitle:function(e){return t.setState({title:e})},feature:e.feature})}}},{key:"render",value:function(){var e=this;return r.a.createElement(f.a.Sider,{className:"sidebar",breakpoint:"lg",collapsedWidth:"0",onBreakpoint:function(e){console.log(e)},onCollapse:function(e,t){console.log(e,t)},width:this.getWidth(),style:{background:"#fff",borderLeft:"1px solid #02264d",borderRight:"1px solid #02264d"}},r.a.createElement("div",{style:{height:"100%",width:"100%",padding:8}},this.props.SearchStore.grids.filter(function(e){return"left"==e.position}).map(function(t,a,n){var o;return r.a.createElement("div",{key:"grid_left_"+a},r.a.createElement(Ze.default,{key:"in_panel",name:"in_panel",size:"small",ghost:!0,icon:"fullscreen",style:{marginLeft:10},type:"primary",onClick:function(){e.props.dispatch({type:"GRID_",id:t.id})}}),",",r.a.createElement(Ze.default,(o={key:"to_right",name:"borderRight",size:"small",ghost:!0,icon:"border-right"},Object(la.a)(o,"ghost",!0),Object(la.a)(o,"style",{marginLeft:10}),Object(la.a)(o,"type","primary"),Object(la.a)(o,"onClick",function(){e.props.dispatch({type:"GRID_TO_RIGHT",id:t.id})}),o)),",",r.a.createElement(G.a,{key:"key_btn",name:"clearSearch",size:"small",ghost:!0,icon:"close",style:{marginLeft:10},type:"danger",onClick:function(){t.onRemove&&t.onRemove(),e.props.dispatch({type:"REMOVE_GRID",id:t.id})}}),r.a.createElement(ca.a,{style:{marginTop:12},defaultActiveKey:"0"},t.layers.map(function(t,a,n){return r.a.createElement(qn,{tab:t.layer_identifier,key:""+a},r.a.createElement(za,{map:e.props.map,layer:t}),r.a.createElement("div",{style:{marginTop:7}},t.query&&""!=t.query?r.a.createElement(r.a.Fragment,null,r.a.createElement(Ze.default,{type:"primary",ghost:!0,size:"small",onClick:function(){return e.downloadShape(t)}},r.a.createElement(ra.a,{icon:oa.c,style:{fontSize:10,marginRight:6}})," Shape"),r.a.createElement(Ze.default,{type:"primary",size:"small",style:{marginLeft:5},onClick:function(){return e.downloadCsv(t)}},r.a.createElement(ra.a,{icon:oa.d,style:{fontSize:10,marginRight:6}})," CSV")):null))})))}),this.props.SearchStore.panels.filter(function(e){return"left"==e.position}).map(function(t,a,n){var o;return r.a.createElement("div",{key:"grid_left_"+a},r.a.createElement(Ze.default,{key:"in_panel",name:"in_panel",size:"small",ghost:!0,icon:"fullscreen",style:{marginLeft:10},type:"primary",onClick:function(){e.props.dispatch({type:"PANEL_",id:t.id})}}),",",r.a.createElement(Ze.default,(o={key:"to_right",name:"borderRight",size:"small",ghost:!0,icon:"border-right"},Object(la.a)(o,"ghost",!0),Object(la.a)(o,"style",{marginLeft:10}),Object(la.a)(o,"type","primary"),Object(la.a)(o,"onClick",function(){e.props.dispatch({type:"PANEL_TO_RIGHT",id:t.id})}),o)),",",r.a.createElement(G.a,{key:"key_btn",name:"clearSearch",size:"small",ghost:!0,icon:"close",style:{marginLeft:10},type:"danger",onClick:function(){t.onRemove&&t.onRemove(),e.props.dispatch({type:"REMOVE_PANEL",id:t.id})}}),r.a.createElement("div",{style:{marginTop:12}},e.returnPanel(t)))})))}}]),t}(n.Component),Vn=Object(y.b)(function(e){return{SearchStore:e.SearchStore}})(Yn),Un=ca.a.TabPane,Wn=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={active:null},a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.SearchStore.grids.filter(function(e){return"right"===e.position})===this.props.SearchStore.grids.filter(function(e){return"right"===e.position})&&e.SearchStore.panels.filter(function(e){return"right"===e.position})===this.props.SearchStore.panels.filter(function(e){return"right"===e.position})||this.resize()}},{key:"resize",value:function(){var e=this;setTimeout(function(){e.props.map.updateSize()},500)}},{key:"getWidth",value:function(){return this.props.SearchStore.grids.filter(function(e){return"right"==e.position}).length>0||this.props.SearchStore.panels.filter(function(e){return"right"==e.position}).length>0?300:0}},{key:"returnPanel",value:function(e){var t=this;switch(e.layer_name){case"Eventi":case"Eventi chiusi":return r.a.createElement(Ba,{changeTitle:function(e){return t.setState({title:e})},el:e,map:this.props.map});case"Segnalazioni":case"Segnalazioni chiuse":return r.a.createElement(un,{changeTitle:function(e){return t.setState({title:e})},el:e,map:this.props.map});case"Organizzazioni":return r.a.createElement(Qa,{changeTitle:function(e){return t.setState({title:e})},el:e,map:this.props.map});case"Risorsa":return r.a.createElement(tn,{changeTitle:function(e){return t.setState({title:e})},el:e,map:this.props.map});default:return r.a.createElement(pn,{changeTitle:function(e){return t.setState({title:e})},feature:e.feature})}}},{key:"render",value:function(){var e=this;return r.a.createElement(f.a.Sider,{className:"sidebar",breakpoint:"lg",collapsedWidth:"0",onBreakpoint:function(e){console.log(e)},onCollapse:function(e,t){console.log(e,t)},width:this.getWidth(),style:{background:"#fff",borderLeft:"1px solid #02264d"}},r.a.createElement("div",{style:{height:"100%",width:"100%",padding:8}},this.props.SearchStore.grids.filter(function(e){return"right"==e.position}).map(function(t,a,n){var o;return r.a.createElement("div",{key:"grid_right_"+a},r.a.createElement(Ze.default,{key:"in_panel",name:"in_panel",size:"small",ghost:!0,icon:"fullscreen",style:{marginLeft:10},type:"primary",onClick:function(){e.props.dispatch({type:"GRID_",id:t.id})}}),",",r.a.createElement(Ze.default,(o={key:"to_right",name:"borderRight",size:"small",ghost:!0,icon:"border-left"},Object(la.a)(o,"ghost",!0),Object(la.a)(o,"style",{marginLeft:10}),Object(la.a)(o,"type","primary"),Object(la.a)(o,"onClick",function(){e.props.dispatch({type:"GRID_TO_LEFT",id:t.id})}),o)),",",r.a.createElement(G.a,{key:"key_btn",name:"clearSearch",size:"small",ghost:!0,icon:"close",style:{marginLeft:10},type:"danger",onClick:function(){t.onRemove&&t.onRemove(),e.props.dispatch({type:"REMOVE_GRID",id:t.id})}}),r.a.createElement(ca.a,{style:{marginTop:12},defaultActiveKey:"0"},t.layers.map(function(t,a,n){return r.a.createElement(Un,{tab:t.layer_identifier,key:""+a},r.a.createElement(za,{map:e.props.map,layer:t}),r.a.createElement("div",{style:{marginTop:7}},t.query&&""!=t.query?r.a.createElement(r.a.Fragment,null,r.a.createElement(Ze.default,{type:"primary",ghost:!0,size:"small",onClick:function(){return e.downloadShape(t)}},r.a.createElement(ra.a,{icon:oa.c,style:{fontSize:10,marginRight:6}})," Shape"),r.a.createElement(Ze.default,{type:"primary",size:"small",style:{marginLeft:5},onClick:function(){return e.downloadCsv(t)}},r.a.createElement(ra.a,{icon:oa.d,style:{fontSize:10,marginRight:6}})," CSV")):null))})))}),this.props.SearchStore.panels.filter(function(e){return"right"==e.position}).map(function(t,a,n){var o;return r.a.createElement("div",{key:"grid_right_"+a},r.a.createElement(Ze.default,{key:"in_panel",name:"in_panel",size:"small",ghost:!0,icon:"fullscreen",style:{marginLeft:10},type:"primary",onClick:function(){e.props.dispatch({type:"PANEL_",id:t.id})}}),",",r.a.createElement(Ze.default,(o={key:"to_right",name:"borderRight",size:"small",ghost:!0,icon:"border-left"},Object(la.a)(o,"ghost",!0),Object(la.a)(o,"style",{marginLeft:10}),Object(la.a)(o,"type","primary"),Object(la.a)(o,"onClick",function(){e.props.dispatch({type:"PANEL_TO_LEFT",id:t.id})}),o)),",",r.a.createElement(G.a,{key:"key_btn",name:"clearSearch",size:"small",ghost:!0,icon:"close",style:{marginLeft:10},type:"danger",onClick:function(){t.onRemove&&t.onRemove(),e.props.dispatch({type:"REMOVE_PANEL",id:t.id})}}),r.a.createElement("div",{style:{marginTop:12}},e.returnPanel(t)))})))}}]),t}(n.Component),Bn=Object(y.b)(function(e){return{SearchStore:e.SearchStore}})(Wn),Xn=(a(1138),f.a.Header),Hn=f.a.Content,Kn=a(467).default,Jn=a(110).default,Zn=Object(v.mappify)(Object(v.onDropAware)(v.MapComponent)),$n=Object(b.d)(b.a.apply(void 0,[]))(b.e)(C),Qn=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={visible:!1,map:!1,className:"mappa-attiva",request_in_progress:!1,loaded_map:!1},a.mounted=!1,a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"verifyLogin",value:function(){var e=Object(c.a)(l.a.mark(function e(){var t,a,n=this;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(window.access_token&&!localStorage.getItem("token")&&localStorage.setItem("token",window.access_token),!localStorage.getItem("token")){e.next=11;break}if(t=localStorage.getItem("token"),a=fn()(t),!(S()()>S()(a.exp,"X"))){e.next=9;break}localStorage.removeItem("token"),$n.dispatch({type:"SET_USER_STORE",obj:{loggedIn:!1}}),e.next=11;break;case 9:return e.next=11,Kt(function(){var e=Object(c.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:$n.dispatch({type:"SET_USER_STORE",obj:{jwt:localStorage.getItem("token"),loggedIn:!0,user:t.data.user,permissions:t.data.permissions}}),n.loadStubs();case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),function(e){$n.dispatch({type:"SET_USER_STORE",obj:{loggedIn:!0}})});case 11:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"loadMap",value:function(){var e=Object(c.a)(l.a.mark(function e(){var t,a,n=this;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initMap();case 2:return t=e.sent,e.next=5,this.setState({map:t});case 5:Se(this.state.map),a=setInterval(function(){try{je(t).length>0&&(n.setState({loaded_map:!0}),window.clearInterval(a))}catch(e){console.log(e)}},100);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"initMap",value:function(){var e=Object(c.a)(l.a.mark(function e(){var t,a,n,r,o,i;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new URLSearchParams(window.location.search),a=41.878987626144436,n=12.505316734313965,r=10,t.get("lat")&&t.get("lon")&&(a=parseFloat(t.get("lat")),n=parseFloat(t.get("lon")),r=16),o=L.transform([n,a],"EPSG:4326","EPSG:3857"),i=new Jn({interactions:Object(g.a)(),view:new Kn({center:o,projection:"EPSG:3857",zoom:r}),layers:[]}),setInterval(function(){Ce(i)},15e3),e.abrupt("return",i);case 9:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"loadStubs",value:function(){A(function(e){$n.dispatch({type:"LOADED_DATA",data:e.data})},function(e){console.log(e)})}},{key:"componentDidMount",value:function(){var e=Object(c.a)(l.a.mark(function e(){var t=this;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.mounted=!0,a=function(e){return t.handleRequestStatusChange(e,t)},gn.push(a),this.loadMap(),this.verifyLogin();case 4:case"end":return e.stop()}var a},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"handleRequestStatusChange",value:function(){var e=Object(c.a)(l.a.mark(function e(){var t,a=arguments;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]&&a[0],!(a.length>1?a[1]:void 0).mounted){e.next=5;break}return e.next=5,this.setState({request_in_progress:t});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){var e=Object(c.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.mounted=!1;case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement(y.a,{store:$n},this.state.map?r.a.createElement("div",{style:{minWidth:1e3,maxHeight:"100vh"},className:"App"+(this.state.request_in_progress?" loading":"")},r.a.createElement(f.a,null,r.a.createElement(Xn,{style:{background:"#fff",padding:0}},r.a.createElement("img",{src:x.a,alt:"Regione Lazio protezione civile",style:{width:170,marginLeft:12}}),r.a.createElement(De,{map:this.state.map}),r.a.createElement($t,null)),r.a.createElement(Xn,{style:{background:"#0059b3",padding:0,height:35}},r.a.createElement(Pe,{map:this.state.map})),r.a.createElement(f.a,null,r.a.createElement(Cn,{map:this.state.map}),r.a.createElement(Mn,{map:this.state.map}),r.a.createElement(Vn,{map:this.state.map}),r.a.createElement(f.a,{style:{marginBottom:-64}},r.a.createElement(Hn,{style:{position:"relative"}},r.a.createElement(v.MapProvider,{map:this.state.map},this.state.loaded_map?r.a.createElement(zn,{map:this.state.map}):null,r.a.createElement(Zn,null),r.a.createElement(sa,{map:this.state.map}),r.a.createElement(Bt,{loading:function(t){return e.setState({request_in_progress:t})},map:this.state.map}),r.a.createElement(Ca,{map:this.state.map}),r.a.createElement(hn,{map:this.state.map})))),r.a.createElement(Bn,{map:this.state.map})))):null)}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(Qn,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},625:function(e,t,a){e.exports=a.p+"static/media/logo.dab562db.png"},626:function(e,t,a){e.exports=a.p+"static/media/helicopter-red.037a0532.png"},627:function(e,t,a){e.exports=a.p+"static/media/helicopter.57bca5e5.png"},628:function(e,t,a){e.exports=a.p+"static/media/elicottero_legend.e45d9abc.png"},641:function(e,t,a){e.exports=a.p+"static/media/osm.f8b6ad92.png"},642:function(e,t,a){e.exports=a.p+"static/media/realvista.6b6eb0e1.png"},653:function(e,t,a){e.exports=a(1141)},658:function(e,t,a){},664:function(e,t,a){},665:function(e,t,a){}},[[653,1,2]]]);